"use strict";exports.id=9144,exports.ids=[9144],exports.modules={29144:(e,a,s)=>{s.d(a,{default:()=>G});var n=s(37307),r=s(67078),t=s(21504),i=s(76884),l=s(29844),o=s(84245),c=s(18811),d=s(65192),m=s(4136),u=s(705),h=s(34371),x=s(23169),j=s(38848),b=s(69246),p=s(45944),g=s(78156),f=s(51673),y=s(89284),v=s(78758),w=s(86624),N=s(10644),_=s(52855),P=s(32371),z=s(89983);let C=(0,P.Ue)(e=>({action:null,setAction:a=>e({action:a}),isLoading:!1,setIsLoading:a=>e({isLoading:a}),details:null,setDetails:a=>e({details:a}),reset:()=>e({action:null,isLoading:!1,details:null})}));z.z.object({reason:z.z.string()}),z.z.object({reason:z.z.string(),duration:z.z.string()}),z.z.object({comment:z.z.string()}),z.z.object({reason:z.z.string(),duration:z.z.string()}),z.z.enum(["unban","reban","comment","edit","delete"]);var D=s(14231),A=s(68527),T=s(50436),R=s(89157),Z=s(94900),S=s(38375),I=s(74410),E=s(20618),L=s(96161),k=s(54567),M=s(79952),Y=s(24787),B=s(58211),X=s(84410),$=s(31672);let F=z.z.object({player_steamid:z.z.string().optional(),player_ip:z.z.string().optional(),reason:z.z.string().min(3),duration:z.z.string(),comment:z.z.string().optional()}),U=({open:e,setOpen:a,mutate:s})=>{let[r,t]=(0,x.useState)(!1),i=async()=>{if(!r){t(!0);try{await (0,$.Z)("/api/bans",{method:"POST",data:l.values}),await s(),I.Am.success("Succesfully banned player!"),a(!1)}catch(a){let e=a?.response?.data||a?.message;console.error(a),I.Am.error(`Failed to create ban!
${e||a}`)}t(!1)}},l=(0,E.c)({initialValues:{player_steamid:"",player_ip:"",reason:"",duration:"",comment:""},validate:(0,L.F)(F)});return n.jsx(k.R,{isOpen:e,onOpenChange:r?void 0:a,children:n.jsx(M.A,{children:e=>(0,n.jsxs)("form",{onSubmit:l.onSubmit(i),children:[n.jsx(Y.k,{className:"flex flex-col gap-1",children:"Create new ban"}),(0,n.jsxs)(B.I,{children:[n.jsx("p",{children:"You can ban a player by either their Steam64 / SteamId / Profile URL or their IP address."}),n.jsx(w.Y,{...l.getInputProps("player_steamid"),errorMessage:l.errors.player_steamid,isInvalid:!!l.errors.player_steamid,label:"Player Steam64 / SteamId / Profile URL",placeholder:"7656XXXXXX",variant:"bordered",isDisabled:r||!!l.values.player_ip,autoFocus:!0}),n.jsx(w.Y,{...l.getInputProps("player_ip"),errorMessage:l.errors.player_ip,isInvalid:!!l.errors.player_ip,label:"IP Address",placeholder:"1.1.1.1",variant:"bordered",isDisabled:r||!!l.values.player_steamid}),n.jsx(w.Y,{...l.getInputProps("reason"),errorMessage:l.errors.reason,isInvalid:!!l.errors.reason,label:"Reason (min 3 characters)",placeholder:"Cheating / Griefing / Toxicity / etc.",variant:"bordered",isDisabled:r}),n.jsx(w.Y,{...l.getInputProps("duration"),errorMessage:l.errors.duration,isInvalid:!!l.errors.duration,label:"Duration in minutes",placeholder:"for example, 60",description:"0 for permanent",variant:"bordered",type:"number",isDisabled:r}),n.jsx(w.Y,{...l.getInputProps("comment"),errorMessage:l.errors.comment,isInvalid:!!l.errors.comment,label:"Comment (optional)",variant:"bordered",isDisabled:r}),(0,n.jsxs)("div",{className:"flex flex-col text-xs",children:[(0,n.jsxs)("span",{children:["The ban will start now ",(0,n.jsxs)("b",{children:["(",(0,D.Z)(),")"]})]}),(0,n.jsxs)("span",{children:["and will end at"," ",n.jsx("b",{children:"0"===l.values.duration?n.jsx("b",{className:"text-red-700",children:"Permanent"}):(0,D.Z)(new Date().getTime()+6e4*Number(l.values.duration))})]})]})]}),(0,n.jsxs)(X.R,{children:[n.jsx(y.A,{color:"danger",variant:"flat",onPress:e,isDisabled:r,children:"Cancel"}),n.jsx(y.A,{color:"primary",type:"submit",isLoading:r,children:"Ban player"})]})]})})})},V=e=>{switch(e){case"ACTIVE":return n.jsx(N.z,{color:"danger",size:"sm",variant:"flat",radius:"sm",children:"Active"});case"EXPIRED":return n.jsx(N.z,{color:"success",size:"sm",variant:"flat",radius:"sm",children:"Expired"});case"UNBANNED":return n.jsx(N.z,{color:"secondary",size:"sm",variant:"flat",radius:"sm",children:"Removed"});default:return n.jsx(N.z,{color:"secondary",size:"sm",variant:"flat",radius:"sm",children:"Unknown"})}};var W=s(25640),O=s(84841);let G=({type:e})=>{let[a,s]=(0,x.useState)(!1),[P,z]=(0,x.useState)(1),[E,L]=(0,x.useState)(""),[k]=(0,v.Nr)(E,500),M=10;"/"===(0,f.usePathname)()&&(M=5);let{data:Y,isLoading:B,mutate:X}=(0,O.ZP)(`/api/bans?page=${P}&rows=${M}&query=${k}`,S.Z,{keepPreviousData:!0}),F=(0,x.useMemo)(()=>Y?.count?Math.ceil(Y.count/M):0,[Y?.count,M]),{admin:G}=(0,Z.ZP)(),{x:J,y:H,open:q,handleCloseMenu:K,handleOpen:Q,info:ee}=(0,T.Z)(),ea=C(e=>e.action),es=C(e=>e.setAction),en=C(e=>e.details),er=C(e=>e.setDetails),et=C(e=>e.isLoading),ei=C(e=>e.setIsLoading),el=C(e=>e.reset),eo=async()=>{if(ea&&!et&&ee){ei(!0);try{await $.Z.post(`/api/bans/${ee.id}`,{action:ea,details:en}),await X(),el(),I.ZP.success(`Player ${ea}ed successfully`)}catch(e){I.ZP.error(`Error ${ea} player`)}ei(!1)}},ec=(e,a)=>{switch(a){case"player_name":return n.jsx(W.default,{href:`https://steamcommunity.com/profiles/${e.player_steamid}`,target:"_blank",passHref:!0,children:n.jsx(_.z,{avatarProps:{radius:"lg",src:e.player_avatar||""},name:e.player_name,children:e.player_name?.slice(0,10)})});case"status":return V(e.status);case"reason":return e.reason.length>10?n.jsx(g.e,{content:e.reason,showArrow:!0,children:n.jsx("div",{className:"text-xs font-light",children:e.reason.slice(0,10)})}):n.jsx("div",{className:"text-xs font-light",children:e.reason});case"unban_reason":return e.unban_reason&&e.unban_reason.length>10?n.jsx(g.e,{content:e.unban_reason,showArrow:!0,children:n.jsx("div",{className:"text-xs font-light",children:e.unban_reason?.slice(0,10)})}):n.jsx("div",{className:"text-xs font-light",children:e.unban_reason});case"duration":return n.jsx(N.z,{color:"primary",size:"sm",variant:"flat",radius:"sm",children:0===e.duration?"Permanent":`${e.duration} minutes`});case"admin_name":return e.admin_name?"Console"===e.admin_name?n.jsx(N.z,{color:"danger",size:"sm",variant:"flat",radius:"sm",children:"Console"}):n.jsx(W.default,{href:`https://steamcommunity.com/profiles/${e.admin_steamid}`,target:"_blank",passHref:!0,children:n.jsx(_.z,{avatarProps:{radius:"lg",src:e.admin_avatar||""},name:e.admin_name,children:e.admin_name})}):n.jsx(n.Fragment,{children:"-"});case"timeLeft":if(0===e.duration)return n.jsx(N.z,{color:"danger",size:"sm",variant:"flat",radius:"sm",children:"Permanent"});if("UNBANNED"===e.status||"EXPIRED"===e.status)return n.jsx(b.W,{color:"success",value:100,isStriped:!0});let s=new Date,r=new Date(e.created),t=new Date(e.ends),i=Math.round((s.getTime()-r.getTime())/(t.getTime()-r.getTime())*100),l=Math.round((t.getTime()-s.getTime())/6e4),o=i<50?"warning":i>=100?"success":"primary";return l>0?n.jsx(g.e,{content:`${l} minutes left`,color:o,showArrow:!0,children:n.jsx(b.W,{color:o,value:i,isStriped:!0})}):n.jsx(b.W,{color:o,value:i,isStriped:!0});case"comment":return e.comment?e.comment.length>10?n.jsx(g.e,{content:e.comment,showArrow:!0,children:n.jsx("div",{className:"text-xs font-light",children:e.comment?.slice(0,10)})}):n.jsx("div",{className:"text-xs font-light",children:e.comment?.slice(0,10)}):n.jsx(n.Fragment,{children:"-"});case"created":return(0,D.Z)(e.created);default:return n.jsx(n.Fragment,{})}},ed=n.jsx(n.Fragment,{});switch(e){case"MANAGE":ed=(0,n.jsxs)(r.J,{children:[n.jsx(t.j,{children:"Player"},"player_name"),n.jsx(t.j,{children:"Status"},"status"),n.jsx(t.j,{children:"Admin"},"admin_name"),n.jsx(t.j,{children:"Reason"},"reason"),n.jsx(t.j,{children:"Remove Reason"},"unban_reason"),n.jsx(t.j,{children:"Date/Time"},"created"),n.jsx(t.j,{children:"Duration"},"duration"),n.jsx(t.j,{children:"Time left"},"timeLeft"),n.jsx(t.j,{children:"Comment"},"comment")]});break;case"SMALL":ed=(0,n.jsxs)(r.J,{children:[n.jsx(t.j,{children:"Player"},"player_name"),n.jsx(t.j,{children:"Status"},"status"),n.jsx(t.j,{children:"Reason"},"reason"),n.jsx(t.j,{children:"Duration"},"duration"),n.jsx(t.j,{children:"Time left"},"timeLeft")]});break;case"NORMAL":ed=(0,n.jsxs)(r.J,{children:[n.jsx(t.j,{children:"Player"},"player_name"),n.jsx(t.j,{children:"Status"},"status"),n.jsx(t.j,{children:"Admin"},"admin_name"),n.jsx(t.j,{children:"Reason"},"reason"),n.jsx(t.j,{children:"Remove Reason"},"unban_reason"),n.jsx(t.j,{children:"Date/Time"},"created"),n.jsx(t.j,{children:"Duration"},"duration"),n.jsx(t.j,{children:"Time left"},"timeLeft")]})}let em=["@css/ban","@css/root","@css/unban","@web/bans"],eu=G?.flags?.some(e=>em.includes(e))||!1;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(i.b,{topContent:(0,n.jsxs)("div",{className:"flex flex-row justify-between",children:[(0,n.jsxs)("div",{className:"text-start",children:[n.jsx("h1",{className:"text-2xl font-bold",children:"Bans"}),(0,n.jsxs)("code",{className:"text-sm font-normal",children:["total: ",Y?.count||""]})]}),(0,n.jsxs)("div",{className:"flex",children:[n.jsx(g.e,{content:"Search for player name, steamid, IP, reason, etc.",closeDelay:50,color:"primary",delay:400,children:n.jsx(w.Y,{label:"Search",labelPlacement:"outside-left",value:E,onValueChange:L,size:"sm",classNames:{mainWrapper:"h-fit",base:"h-fit"},isClearable:!0})}),G&&eu&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(y.A,{size:"sm",variant:"flat",color:"primary",onClick:()=>s(!0),children:[n.jsx(d.Z,{size:46}),"New ban"]}),n.jsx(U,{open:a,setOpen:s,mutate:X})]})]})]}),bottomContent:(0,n.jsxs)(n.Fragment,{children:[n.jsx("div",{className:"flex w-full justify-center",children:n.jsx(j.g,{color:"primary",page:P,total:F,onChange:e=>z(e),size:"sm",isCompact:!0,showControls:!0,showShadow:!0})}),G&&"MANAGE"===e&&n.jsx("span",{className:"text-sm",children:"Tip, your can right click on a player row for more actions"})]}),children:[ed,n.jsx(l.y,{items:Y?.results??[],loadingContent:n.jsx(p.c,{}),loadingState:B?"loading":"idle",children:e=>n.jsx(o.g,{onContextMenu:a=>G&&Q&&Q(a,e)||void 0,children:a=>n.jsx(c.X,{children:ec(e,a)})},e.id)})]}),G&&n.jsx(R.Z,{open:q,x:J,y:H,handleCloseMenu:K,items:[{category:"Ban Actions",items:[{key:"Comment",description:"Write a comment on this ban, this will be visible to other admins",icon:m.Z,color:"default",onClick:()=>{es("comment"),er({comment:ee?.comment||""})},flags:["@css/root","@css/ban","@web/bans","@web/root"]},{key:ee?.status==="UNBANNED"||ee?.status==="EXPIRED"?"Reban":"Remove Ban (shorten)",description:ee?.status==="UNBANNED"||ee?.status==="EXPIRED"?"Reban the player":"Remove the player ban (shorten the duration)",icon:u.Z,color:"default",onClick:()=>{ee?.status==="UNBANNED"||ee?.status==="EXPIRED"?(es("reban"),er({reason:"",duration:"0"})):(es("unban"),er({reason:""}))},flags:["@css/root","@css/ban","@web/bans","@web/root"]},{key:"Edit Ban",description:"Edit the ban duration or reason",icon:m.Z,color:"primary",onClick:()=>{es("edit"),er({reason:ee?.reason||"",duration:ee?.duration?.toString()||"0"})},flags:["@css/root","@css/ban","@web/bans","@web/root"]},{key:"Delete Ban",description:"Delete the ban from the database (permanent action)",icon:h.Z,color:"danger",onClick:()=>{es("delete")},flags:["@css/root","@css/ban","@web/bans","@web/root"]}]}]}),G&&(0,n.jsxs)(A.Z,{open:"comment"===ea,handleClose:el,action:eo,isLoading:et,actionText:"Save",children:[n.jsx("div",{children:"Write a comment on this ban, this will be visible to other admins"}),n.jsx(w.Y,{label:"Comment",value:en?.comment||"",onValueChange:e=>er({comment:e})})]}),G&&(0,n.jsxs)(A.Z,{open:"unban"===ea,handleClose:el,action:eo,isLoading:et,actionText:"Unban",children:[n.jsx("div",{children:"You sure you want to unban the user?"}),n.jsx(w.Y,{label:"Reason",value:en?.reason||"",onValueChange:e=>er({reason:e})})]}),G&&(0,n.jsxs)(A.Z,{open:"reban"===ea,handleClose:el,action:eo,isLoading:et,actionText:"Reban",children:[n.jsx("div",{children:"You sure you want to reban the user?"}),n.jsx(w.Y,{label:"Reason",value:en?.reason||"",onValueChange:e=>er({...en,reason:e})}),n.jsx(w.Y,{label:"Time (in minutes)",type:"number",value:en?.duration||"",onValueChange:e=>er({...en,duration:e}),description:"Time in minutes, 0 = Permanent ban"}),(0,n.jsxs)("div",{className:"flex flex-col text-xs",children:[(0,n.jsxs)("span",{children:["The ban will start again at ",n.jsx("b",{children:(0,D.Z)()})]}),(0,n.jsxs)("span",{children:["the ban will end at"," ",n.jsx("b",{children:en?.duration==="0"?n.jsx("b",{className:"text-red-700",children:"Permanent"}):(0,D.Z)(new Date().getTime()+6e4*Number(en?.duration))})]})]})]}),G&&(0,n.jsxs)(A.Z,{open:"edit"===ea,handleClose:el,action:eo,isLoading:et,actionText:"Edit",children:[n.jsx("div",{children:"This will replace the ban duration or reason"}),n.jsx(w.Y,{label:"Ban Reason",value:en?.reason||"",onValueChange:e=>er({...en,reason:e})}),n.jsx(w.Y,{label:"Ban Time (in minutes)",type:"number",value:en?.duration||"",onValueChange:e=>er({...en,duration:e}),description:"Time in minutes, this will be added to the current duration, 0 = Permanent ban (will replace the duration)"}),(0,n.jsxs)("div",{className:"flex flex-col text-xs",children:[(0,n.jsxs)("span",{children:["The ban started at ",n.jsx("b",{children:(0,D.Z)(ee?.created)})]}),(0,n.jsxs)("span",{children:["After the edit, the ban will end at"," ",n.jsx("b",{children:en?.duration==="0"?n.jsx("b",{className:"text-red-700",children:"Permanent"}):(0,D.Z)(new Date(ee?.created||"").getTime()+6e4*Number(en?.duration))})]})]})]}),G&&n.jsx(A.Z,{open:"delete"===ea,handleClose:el,action:eo,isLoading:et,actionText:"Delete",children:n.jsx("div",{children:"Are you sure you want to delete the ban? this action is permanent and cannot be undone"})})]})}}};