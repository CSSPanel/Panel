"use strict";exports.id=1091,exports.ids=[1091],exports.modules={1091:(e,a,n)=>{n.d(a,{default:()=>H});var s=n(83223),r=n(70568),t=n(15626),i=n(82549),l=n(57165),o=n(1918),d=n(7693),c=n(3701),m=n(81050),u=n(37816),h=n(93391),x=n(82562),b=n(8405),j=n(62059),p=n(41673),g=n(18936),f=n(20405),y=n(88751),v=n(96645),w=n(77262),A=n(33883),R=n(22762),N=n(9091),T=n(46531);let C=(0,N.vt)(e=>({action:null,setAction:a=>e({action:a}),isLoading:!1,setIsLoading:a=>e({isLoading:a}),details:null,setDetails:a=>e({details:a}),reset:()=>e({action:null,isLoading:!1,details:null})}));T.z.object({reason:T.z.string()}),T.z.object({reason:T.z.string(),duration:T.z.string()}),T.z.object({comment:T.z.string()}),T.z.object({reason:T.z.string(),duration:T.z.string()}),T.z.enum(["unban","reban","comment","edit","delete"]);var D=n(39228),_=n(90314),P=n(44540),S=n(15688),z=n(3980),I=n(74549),E=n(45034),L=n(65151),B=n(9032),k=n(5289),M=n(549),X=n(25615),$=n(19206),U=n(68458),F=n(61571);let V=T.z.object({player_steamid:T.z.string().optional(),player_ip:T.z.string().optional(),reason:T.z.string().min(3),duration:T.z.string(),comment:T.z.string().optional()}),O=({open:e,setOpen:a,mutate:n})=>{let[r,t]=(0,x.useState)(!1),i=async()=>{if(!r){t(!0);try{await (0,F.A)("/api/bans",{method:"POST",data:l.values}),await n(),E.oR.success("Succesfully banned player!"),a(!1)}catch(a){let e=a?.response?.data||a?.message;console.error(a),E.oR.error(`Failed to create ban!
${e||a}`)}t(!1)}},l=(0,L.m)({initialValues:{player_steamid:"",player_ip:"",reason:"",duration:"",comment:""},validate:(0,B.u)(V)});return(0,s.jsx)(k.Y,{isOpen:e,onOpenChange:r?void 0:a,children:(0,s.jsx)(M.g,{children:e=>(0,s.jsxs)("form",{onSubmit:l.onSubmit(i),children:[(0,s.jsx)(X.c,{className:"flex flex-col gap-1",children:"Create new ban"}),(0,s.jsxs)($.h,{children:[(0,s.jsx)("p",{children:"You can ban a player by either their Steam64 / SteamId / Profile URL or their IP address."}),(0,s.jsx)(w.r,{...l.getInputProps("player_steamid"),errorMessage:l.errors.player_steamid,isInvalid:!!l.errors.player_steamid,label:"Player Steam64 / SteamId / Profile URL",placeholder:"7656XXXXXX",variant:"bordered",isDisabled:r||!!l.values.player_ip,autoFocus:!0}),(0,s.jsx)(w.r,{...l.getInputProps("player_ip"),errorMessage:l.errors.player_ip,isInvalid:!!l.errors.player_ip,label:"IP Address",placeholder:"1.1.1.1",variant:"bordered",isDisabled:r||!!l.values.player_steamid}),(0,s.jsx)(w.r,{...l.getInputProps("reason"),errorMessage:l.errors.reason,isInvalid:!!l.errors.reason,label:"Reason (min 3 characters)",placeholder:"Cheating / Griefing / Toxicity / etc.",variant:"bordered",isDisabled:r}),(0,s.jsx)(w.r,{...l.getInputProps("duration"),errorMessage:l.errors.duration,isInvalid:!!l.errors.duration,label:"Duration in minutes",placeholder:"for example, 60",description:"0 for permanent",variant:"bordered",type:"number",isDisabled:r}),(0,s.jsx)(w.r,{...l.getInputProps("comment"),errorMessage:l.errors.comment,isInvalid:!!l.errors.comment,label:"Comment (optional)",variant:"bordered",isDisabled:r}),(0,s.jsxs)("div",{className:"flex flex-col text-xs",children:[(0,s.jsxs)("span",{children:["The ban will start now ",(0,s.jsxs)("b",{children:["(",(0,D.A)(),")"]})]}),(0,s.jsxs)("span",{children:["and will end at"," ",(0,s.jsx)("b",{children:"0"===l.values.duration?(0,s.jsx)("b",{className:"text-red-700",children:"Permanent"}):(0,D.A)(new Date().getTime()+6e4*Number(l.values.duration))})]})]})]}),(0,s.jsxs)(U.q,{children:[(0,s.jsx)(y.T,{color:"danger",variant:"flat",onPress:e,isDisabled:r,children:"Cancel"}),(0,s.jsx)(y.T,{color:"primary",type:"submit",isLoading:r,children:"Ban player"})]})]})})})},Y=e=>{switch(e){case"ACTIVE":return(0,s.jsx)(A.R,{color:"danger",size:"sm",variant:"flat",radius:"sm",children:"Active"});case"EXPIRED":return(0,s.jsx)(A.R,{color:"success",size:"sm",variant:"flat",radius:"sm",children:"Expired"});case"UNBANNED":return(0,s.jsx)(A.R,{color:"secondary",size:"sm",variant:"flat",radius:"sm",children:"Removed"});default:return(0,s.jsx)(A.R,{color:"secondary",size:"sm",variant:"flat",radius:"sm",children:"Unknown"})}};var G=n(97598),W=n.n(G),q=n(34438);let H=({type:e})=>{let[a,n]=(0,x.useState)(!1),[N,T]=(0,x.useState)(1),[L,B]=(0,x.useState)(""),[k]=(0,v.d7)(L,500),M=10;"/"===(0,f.usePathname)()&&(M=5);let{data:X,isLoading:$,mutate:U}=(0,q.Ay)(`/api/bans?page=${N}&rows=${M}&query=${k}`,I.A,{keepPreviousData:!0}),V=(0,x.useMemo)(()=>X?.count?Math.ceil(X.count/M):0,[X?.count,M]),{admin:G}=(0,z.Ay)(),{x:H,y:J,open:K,handleCloseMenu:Q,handleOpen:Z,info:ee}=(0,P.A)(),ea=C(e=>e.action),en=C(e=>e.setAction),es=C(e=>e.details),er=C(e=>e.setDetails),et=C(e=>e.isLoading),ei=C(e=>e.setIsLoading),el=C(e=>e.reset),eo=async()=>{if(ea&&!et&&ee){ei(!0);try{await F.A.post(`/api/bans/${ee.id}`,{action:ea,details:es}),await U(),el(),E.Ay.success(`Player ${ea}ed successfully`)}catch(e){E.Ay.error(`Error ${ea} player`)}ei(!1)}},ed=(e,a)=>{switch(a){case"player_name":return(0,s.jsx)(W(),{href:`https://steamcommunity.com/profiles/${e.player_steamid}`,target:"_blank",passHref:!0,children:(0,s.jsx)(R.S,{avatarProps:{radius:"lg",src:e.player_avatar||""},name:e.player_name,children:e.player_name?.slice(0,10)})});case"status":return Y(e.status);case"reason":return e.reason.length>10?(0,s.jsx)(g.I,{content:e.reason,"aria-label":"Reason",showArrow:!0,children:(0,s.jsx)("div",{className:"text-xs font-light",children:e.reason.slice(0,10)})}):(0,s.jsx)("div",{className:"text-xs font-light",children:e.reason});case"unban_reason":return e.unban_reason&&e.unban_reason.length>10?(0,s.jsx)(g.I,{content:e.unban_reason,"aria-label":"Remove Reason",showArrow:!0,children:(0,s.jsx)("div",{className:"text-xs font-light",children:e.unban_reason?.slice(0,10)})}):(0,s.jsx)("div",{className:"text-xs font-light",children:e.unban_reason});case"duration":return(0,s.jsx)(A.R,{color:"primary",size:"sm",variant:"flat",radius:"sm",children:0===e.duration?"Permanent":`${e.duration} minutes`});case"admin_name":return e.admin_name?"Console"===e.admin_name?(0,s.jsx)(A.R,{color:"danger",size:"sm",variant:"flat",radius:"sm",children:"Console"}):(0,s.jsx)(W(),{href:`https://steamcommunity.com/profiles/${e.admin_steamid}`,target:"_blank",passHref:!0,children:(0,s.jsx)(R.S,{avatarProps:{radius:"lg",src:e.admin_avatar||""},name:e.admin_name,children:e.admin_name})}):(0,s.jsx)(s.Fragment,{children:"-"});case"timeLeft":if(0===e.duration)return(0,s.jsx)(A.R,{color:"danger",size:"sm",variant:"flat",radius:"sm",children:"Permanent"});if("UNBANNED"===e.status||"EXPIRED"===e.status)return(0,s.jsx)(j.o,{color:"success",value:100,"aria-label":"Expired"});let n=new Date,r=new Date(e.created),t=new Date(e.ends),i=Math.round((n.getTime()-r.getTime())/(t.getTime()-r.getTime())*100),l=Math.round((t.getTime()-n.getTime())/6e4),o=i<50?"warning":i>=100?"success":"primary";return l>0?(0,s.jsx)(g.I,{content:`${l} minutes left`,color:o,"aria-label":"Time left",showArrow:!0,children:(0,s.jsx)(j.o,{color:o,value:i,"aria-label":`${l} minutes left`})}):(0,s.jsx)(j.o,{color:o,value:i,"aria-label":"Expired"});case"comment":return e.comment?e.comment.length>10?(0,s.jsx)(g.I,{content:e.comment,"aria-label":"Comment",showArrow:!0,children:(0,s.jsx)("div",{className:"text-xs font-light",children:e.comment?.slice(0,10)})}):(0,s.jsx)("div",{className:"text-xs font-light",children:e.comment?.slice(0,10)}):(0,s.jsx)(s.Fragment,{children:"-"});case"created":return(0,D.A)(e.created);default:return(0,s.jsx)(s.Fragment,{})}},ec=(0,s.jsx)(s.Fragment,{});switch(e){case"MANAGE":ec=(0,s.jsxs)(r.X,{children:[(0,s.jsx)(t.e,{"aria-label":"Player",children:"Player"},"player_name"),(0,s.jsx)(t.e,{"aria-label":"Status",children:"Status"},"status"),(0,s.jsx)(t.e,{"aria-label":"Admin",children:"Admin"},"admin_name"),(0,s.jsx)(t.e,{"aria-label":"Reason",children:"Reason"},"reason"),(0,s.jsx)(t.e,{"aria-label":"Remove Reason",children:"Remove Reason"},"unban_reason"),(0,s.jsx)(t.e,{"aria-label":"Date/Time",children:"Date/Time"},"created"),(0,s.jsx)(t.e,{"aria-label":"Duration",children:"Duration"},"duration"),(0,s.jsx)(t.e,{"aria-label":"Time left",children:"Time left"},"timeLeft"),(0,s.jsx)(t.e,{"aria-label":"Comment",children:"Comment"},"comment")]});break;case"SMALL":ec=(0,s.jsxs)(r.X,{children:[(0,s.jsx)(t.e,{"aria-label":"Player",children:"Player"},"player_name"),(0,s.jsx)(t.e,{"aria-label":"Status",children:"Status"},"status"),(0,s.jsx)(t.e,{"aria-label":"Reason",children:"Reason"},"reason"),(0,s.jsx)(t.e,{"aria-label":"Duration",children:"Duration"},"duration"),(0,s.jsx)(t.e,{"aria-label":"Time left",children:"Time left"},"timeLeft")]});break;case"NORMAL":ec=(0,s.jsxs)(r.X,{children:[(0,s.jsx)(t.e,{"aria-label":"Player",children:"Player"},"player_name"),(0,s.jsx)(t.e,{"aria-label":"Status",children:"Status"},"status"),(0,s.jsx)(t.e,{"aria-label":"Admin",children:"Admin"},"admin_name"),(0,s.jsx)(t.e,{"aria-label":"Reason",children:"Reason"},"reason"),(0,s.jsx)(t.e,{"aria-label":"Remove Reason",children:"Remove Reason"},"unban_reason"),(0,s.jsx)(t.e,{"aria-label":"Date/Time",children:"Date/Time"},"created"),(0,s.jsx)(t.e,{"aria-label":"Duration",children:"Duration"},"duration"),(0,s.jsx)(t.e,{"aria-label":"Time left",children:"Time left"},"timeLeft")]})}let em=["@web/root","@css/root","@web/bans"],eu=G?.flags?.some(e=>em.includes(e))||!1;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(i.j,{topContent:(0,s.jsxs)("div",{className:"flex flex-row justify-between",children:[(0,s.jsxs)("div",{className:"text-start",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"Bans"}),(0,s.jsxs)("code",{className:"text-sm font-normal",children:["total: ",X?.count||""]})]}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)(g.I,{content:"Search for player name, steamid, IP, reason, etc.",closeDelay:50,color:"primary",delay:400,"aria-label":"Search",children:(0,s.jsx)(w.r,{label:"Search",labelPlacement:"outside-left",value:L,onValueChange:B,size:"sm",classNames:{mainWrapper:"h-fit",base:"h-fit"},"aria-label":"Search",isClearable:!0})}),G&&eu&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(y.T,{size:"sm",variant:"flat",color:"primary",onClick:()=>n(!0),"aria-label":"New ban",children:[(0,s.jsx)(c.A,{size:46,"aria-label":"New ban"}),"New ban"]}),(0,s.jsx)(O,{open:a,setOpen:n,mutate:U})]})]})]}),bottomContent:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"flex w-full justify-center",children:(0,s.jsx)(b.T,{color:"primary",page:N,total:V,onChange:e=>T(e),"aria-label":"Pagination",size:"sm",isCompact:!0,showControls:!0,showShadow:!0})}),G&&"MANAGE"===e&&(0,s.jsx)("span",{className:"text-sm",children:"Tip, your can right click on a player row for more actions"})]}),children:[ec,(0,s.jsx)(l.E,{items:X?.results??[],loadingContent:(0,s.jsx)(p.o,{"aria-label":"Loading"}),loadingState:$?"loading":"idle",children:e=>(0,s.jsx)(o.s,{onContextMenu:a=>G&&Z&&Z(a,e)||void 0,"aria-label":e.player_name||"",children:a=>(0,s.jsx)(d.w,{"aria-label":a.toString(),children:ed(e,a)})},e.id)})]}),G&&(0,s.jsx)(S.A,{open:K,x:H,y:J,handleCloseMenu:Q,items:[{category:"Ban Actions",items:[{key:"Comment",description:"Write a comment on this ban, this will be visible to other admins",icon:m.A,color:"default",onClick:()=>{en("comment"),er({comment:ee?.comment||""})},flags:["@css/root","@web/bans","@web/root"]},{key:ee?.status==="UNBANNED"||ee?.status==="EXPIRED"?"Reban":"Remove Ban (shorten)",description:ee?.status==="UNBANNED"||ee?.status==="EXPIRED"?"Reban the player":"Remove the player ban (shorten the duration)",icon:u.A,color:"default",onClick:()=>{ee?.status==="UNBANNED"||ee?.status==="EXPIRED"?(en("reban"),er({reason:"",duration:"0"})):(en("unban"),er({reason:""}))},flags:["@css/root","@web/bans","@web/root"]},{key:"Edit Ban",description:"Edit the ban duration or reason",icon:m.A,color:"primary",onClick:()=>{en("edit"),er({reason:ee?.reason||"",duration:ee?.duration?.toString()||"0"})},flags:["@css/root","@web/bans","@web/root"]},{key:"Delete Ban",description:"Delete the ban from the database (permanent action)",icon:h.A,color:"danger",onClick:()=>{en("delete")},flags:["@css/root","@web/bans","@web/root"]}]}]}),G&&(0,s.jsxs)(_.A,{open:"comment"===ea,handleClose:el,action:eo,isLoading:et,actionText:"Save",children:[(0,s.jsx)("div",{children:"Write a comment on this ban, this will be visible to other admins"}),(0,s.jsx)(w.r,{label:"Comment",value:es?.comment||"",onValueChange:e=>er({comment:e}),"aria-label":"Comment"})]}),G&&(0,s.jsxs)(_.A,{open:"unban"===ea,handleClose:el,action:eo,isLoading:et,actionText:"Unban",children:[(0,s.jsx)("div",{children:"You sure you want to unban the user?"}),(0,s.jsx)(w.r,{label:"Reason",value:es?.reason||"",onValueChange:e=>er({reason:e}),"aria-label":"Unban Reason"})]}),G&&(0,s.jsxs)(_.A,{open:"reban"===ea,handleClose:el,action:eo,isLoading:et,actionText:"Reban",children:[(0,s.jsx)("div",{children:"You sure you want to reban the user?"}),(0,s.jsx)(w.r,{label:"Reason",value:es?.reason||"",onValueChange:e=>er({...es,reason:e}),"aria-label":"Ban Reason"}),(0,s.jsx)(w.r,{label:"Time (in minutes)",type:"number",value:es?.duration||"",onValueChange:e=>er({...es,duration:e}),description:"Time in minutes, 0 = Permanent ban","aria-label":"Ban Time"}),(0,s.jsxs)("div",{className:"flex flex-col text-xs",children:[(0,s.jsxs)("span",{children:["The ban will start again at ",(0,s.jsx)("b",{children:(0,D.A)()})]}),(0,s.jsxs)("span",{children:["the ban will end at"," ",(0,s.jsx)("b",{children:es?.duration==="0"?(0,s.jsx)("b",{className:"text-red-700",children:"Permanent"}):(0,D.A)(new Date().getTime()+6e4*Number(es?.duration))})]})]})]}),G&&(0,s.jsxs)(_.A,{open:"edit"===ea,handleClose:el,action:eo,isLoading:et,actionText:"Edit",children:[(0,s.jsx)("div",{children:"This will replace the ban duration or reason"}),(0,s.jsx)(w.r,{label:"Ban Reason",value:es?.reason||"",onValueChange:e=>er({...es,reason:e}),"aria-label":"Ban Reason"}),(0,s.jsx)(w.r,{label:"Ban Time (in minutes)",type:"number",value:es?.duration||"",onValueChange:e=>er({...es,duration:e}),description:"Time in minutes, this will be added to the current duration, 0 = Permanent ban (will replace the duration)","aria-label":"Ban Time"}),(0,s.jsxs)("div",{className:"flex flex-col text-xs",children:[(0,s.jsxs)("span",{children:["The ban started at ",(0,s.jsx)("b",{children:(0,D.A)(ee?.created)})]}),(0,s.jsxs)("span",{children:["After the edit, the ban will end at"," ",(0,s.jsx)("b",{children:es?.duration==="0"?(0,s.jsx)("b",{className:"text-red-700",children:"Permanent"}):(0,D.A)(new Date(ee?.created||"").getTime()+6e4*Number(es?.duration))})]})]})]}),G&&(0,s.jsx)(_.A,{open:"delete"===ea,handleClose:el,action:eo,isLoading:et,actionText:"Delete",children:(0,s.jsx)("div",{children:"Are you sure you want to delete the ban? this action is permanent and cannot be undone"})})]})}}};