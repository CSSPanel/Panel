"use strict";(()=>{var e={};e.id=7269,e.ids=[7269],e.modules={429:e=>{e.exports=require("cookie-session")},62418:e=>{e.exports=require("mysql2/promise")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},99648:e=>{e.exports=import("axios")},97564:e=>{e.exports=import("chalk")},45616:e=>{e.exports=import("next-connect")},2782:e=>{e.exports=import("steam-api-sdk")},9926:e=>{e.exports=import("zod")},26330:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>d,default:()=>u,routeModule:()=>c});var s=r(20114),n=r(32128),i=r(57797),l=r(60711),o=e([l]);l=(o.then?(await o)():o)[0];let u=(0,i.l)(l,"default"),d=(0,i.l)(l,"config"),c=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/admin/player-reports",pathname:"/api/admin/player-reports",bundlePath:"",filename:""},userland:l});a()}catch(e){a(e)}})},60711:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>d});var s=r(59236),n=r(14676),i=r(22911),l=r(48874),o=r(78260),u=e([s,n,i,l,o]);[s,n,i,l,o]=u.then?(await u)():u;let d=async(e,t)=>{await o.Z.run(e,t);let{method:r}=e;if(await (0,n.Z)(e,t)){if(!l.Z)return t.status(500).json({message:"Database not connected"});if(!(await (0,s.ed)("player-reports")).enabled)return t.status(404).json({error:"Module not enabled"});if("GET"===r){let{minutes:r}=e.query,a=await l.Z.reports.getByMinutes(Number(r)||10),s=[];a.map(e=>{s.push(e.userId),s.push(e.targetId),e.handlerId&&s.push(e.handlerId)});let n=await (0,i.Z)(s),o=await Promise.all(a.map(async e=>{let t=await l.Z.servers.getById(Number(e.serverId))||null;if(!t)return null;let r=n.find(t=>t.steamid===e.userId),a=n.find(t=>t.steamid===e.targetId),s=n.find(t=>t.steamid===e.handlerId),i={address:t.address,hostname:t.hostname};return{...e,server:i,user:r,target:a,handler:s}}).filter(Boolean));return t.status(200).json(o)}}};a()}catch(e){a(e)}})},22911:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{Z:()=>l});var s=r(2782),n=e([s]);s=(n.then?(await n)():n)[0];let i=new Map,l=async e=>{try{let t=[...new Set(e)].filter(e=>!isNaN(Number(e)));if(!t.length)return[];let r=t.filter(e=>i.has(e)),a=t.filter(e=>!i.has(e)),n=r.map(e=>i.get(e)).filter(e=>void 0!==e)||[],l=[];return a.length>0&&(l=await (0,s.From64ToUser)(a,1e3)||[]).forEach(e=>i.set(e.steamid,e)),[...n,...l]}catch(e){return error(`Failed to get steam users ${e}`),[]}};a()}catch(e){a(e)}})},78260:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{Z:()=>d});var s=r(9014),n=r(45616),i=r(429),l=r.n(i),o=e([n]);n=(o.then?(await o)():o)[0];let u=(0,n.default)();u.use(l()({secret:process.env.SESSION_SECRET||"secret",maxAge:10368e6})),u.use(s.Z.initialize()),u.use(s.Z.session());let d=u;a()}catch(e){a(e)}})},9014:(e,t,r)=>{r.d(t,{Z:()=>l});let a=require("passport");var s=r.n(a);let n=require("passport-steam");s().serializeUser(async(e,t)=>{t(null,e)}),s().deserializeUser(async(e,t)=>{t(null,e)});let i=process.env.DOMAIN||"";i.startsWith("http")||(i=`https://${i}`),s().use(new n.Strategy({returnURL:`${i}/api/auth/return`,realm:`${i}/`,apiKey:process.env.STEAM_API_KEY||""},(e,t,r)=>(t.identifier=e,r(null,t))));let l=s()},14676:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{Z:()=>i});var s=r(48874),n=e([s]);s=(n.then?(await n)():n)[0];let i=(e,t,r,a="AND")=>new Promise(async(n,i)=>{if(!s.Z)return t.status(500).json({message:"Database not connected"});if(!e.user)return i(t.status(400).json({success:!1,error:"Protected Route"}));let l=e.user.id,o=await s.Z.admins.getBySteam64(l);if(!o)return i(t.status(401).json({success:!1,error:"Protected Route"}));if(!r)return n(o);let u=null;if("object"==typeof o.flags)u=o.flags;else{let e=await s.Z.adminGroups.getById(o.flags);e&&(u=e.flags)}if(null===u||!("AND"===a?r.every(e=>u.includes(e)):r.some(e=>u.includes(e))))return i(t.status(403).json({success:!1,error:"Protected Route"}));n(o)});a()}catch(e){a(e)}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[6941],()=>r(26330));module.exports=a})();