"use strict";(()=>{var s={};s.id=2508,s.ids=[2508],s.modules={429:s=>{s.exports=require("cookie-session")},62418:s=>{s.exports=require("mysql2/promise")},20145:s=>{s.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},99648:s=>{s.exports=import("axios")},97564:s=>{s.exports=import("chalk")},45616:s=>{s.exports=import("next-connect")},2782:s=>{s.exports=import("steam-api-sdk")},9926:s=>{s.exports=import("zod")},53281:(s,e,t)=>{t.a(s,async(s,r)=>{try{t.r(e),t.d(e,{config:()=>l,default:()=>u,routeModule:()=>p});var a=t(44614),i=t(49531),n=t(55621),o=t(89789),c=s([o]);o=(c.then?(await c)():c)[0];let u=(0,n.l)(o,"default"),l=(0,n.l)(o,"config"),p=new a.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/auth",pathname:"/api/auth",bundlePath:"",filename:""},userland:o});r()}catch(s){r(s)}})},89789:(s,e,t)=>{t.a(s,async(s,r)=>{try{t.r(e),t.d(e,{default:()=>c});var a=t(10474),i=t(73907),n=s([a,i]);[a,i]=n.then?(await n)():n;let o=["@css/ban","@css/changemap","@css/kick","@css/rcon","@css/root","@css/chat","@css/cheats","@css/config","@css/config","@css/cvar","@css/generic","@css/kick","@css/kick","@css/password","@css/password","@css/rcon","@css/reservation","@css/reservation","@css/root","@css/root","@css/slay","@css/unban","@css/unban","@css/vote","@web/admingroups","@web/admins","@web/bans","@web/logs","@web/mutes","@web/root","@web/servers","@web/stats"],c=async(s,e)=>{await a.Z.run(s,e);let{method:t}=s;if(!i.Z)return e.status(500).json({message:"Database not connected"});if("GET"===t)try{if(!s.user)return e.status(401).json({error:"Unauthorized"});let t=s.user.id,r=await i.Z.admins.getBySteam64(t);if(r){if("string"==typeof r.flags&&r.flags.startsWith("#")){let s=await i.Z.adminGroups.getById(r.flags);s&&(r.group=s,o.some(e=>s.flags.includes(e))||(r.flags=[],r.group=void 0))}else o.some(s=>r.flags.includes(s))||(r.flags=[],r.group=void 0)}return e.status(200).json({user:s.user,admin:r})}catch(s){return error("GET /api/auth",s),e.status(400).json({error:"Internal Server Error"})}};r()}catch(s){r(s)}})},10474:(s,e,t)=>{t.a(s,async(s,r)=>{try{t.d(e,{Z:()=>l});var a=t(60276),i=t(45616),n=t(429),o=t.n(n),c=s([i]);i=(c.then?(await c)():c)[0];let u=(0,i.default)();u.use(o()({secret:process.env.SESSION_SECRET||"secret",maxAge:10368e6})),u.use(a.Z.initialize()),u.use(a.Z.session());let l=u;r()}catch(s){r(s)}})},60276:(s,e,t)=>{t.d(e,{Z:()=>o});let r=require("passport");var a=t.n(r);let i=require("passport-steam");a().serializeUser(async(s,e)=>{e(null,s)}),a().deserializeUser(async(s,e)=>{e(null,s)});let n=process.env.DOMAIN||"";n.startsWith("http")||(n=`https://${n}`),a().use(new i.Strategy({returnURL:`${n}/api/auth/return`,realm:`${n}/`,apiKey:process.env.STEAM_API_KEY||""},(s,e,t)=>(e.identifier=s,t(null,e))));let o=a()}};var e=require("../../webpack-api-runtime.js");e.C(s);var t=s=>e(e.s=s),r=e.X(0,[2867],()=>t(53281));module.exports=r})();