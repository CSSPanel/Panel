"use strict";(()=>{var s={};s.id=2508,s.ids=[2508],s.modules={429:s=>{s.exports=require("cookie-session")},62418:s=>{s.exports=require("mysql2/promise")},20145:s=>{s.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3511:s=>{s.exports=require("passport")},53686:s=>{s.exports=require("passport-steam")},99648:s=>{s.exports=import("axios")},97564:s=>{s.exports=import("chalk")},97612:s=>{s.exports=import("drizzle-orm")},99089:s=>{s.exports=import("drizzle-orm/mysql-core")},63024:s=>{s.exports=import("drizzle-orm/mysql2")},45616:s=>{s.exports=import("next-connect")},2782:s=>{s.exports=import("steam-api-sdk")},9926:s=>{s.exports=import("zod")},45747:(s,e,r)=>{r.a(s,async(s,t)=>{try{r.r(e),r.d(e,{config:()=>l,default:()=>u,routeModule:()=>p});var a=r(71802),o=r(47153),i=r(56249),n=r(56167),c=s([n]);n=(c.then?(await c)():c)[0];let u=(0,i.l)(n,"default"),l=(0,i.l)(n,"config"),p=new a.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/auth",pathname:"/api/auth",bundlePath:"",filename:""},userland:n});t()}catch(s){t(s)}})},56167:(s,e,r)=>{r.a(s,async(s,t)=>{try{r.r(e),r.d(e,{default:()=>n});var a=r(79173),o=r(6346),i=s([a,o]);[a,o]=i.then?(await i)():i;let n=async(s,e)=>{await o.Z.run(s,e);let{method:r}=s;if(!a.Z)return e.status(500).json({message:"Database not connected"});let t=["@css/ban","@css/permban","@css/changemap","@css/kick","@css/rcon","@css/root","@css/chat","@css/cheats","@css/config","@css/config","@css/cvar","@css/generic","@css/kick","@css/kick","@css/password","@css/password","@css/rcon","@css/reservation","@css/reservation","@css/root","@css/root","@css/slay","@css/unban","@css/unban","@css/vote","@web/admingroups","@web/admins","@web/bans","@web/logs","@web/mutes","@web/root","@web/servers","@web/stats","@web/rcon",...(await a.Z?.adminFlags.getAll()||[]).map(s=>s.flag)];if("GET"===r)try{if(!s.user)return e.status(401).json({error:"Unauthorized"});let r=s.user.id,o=await a.Z.admins.getBySteam64(r);if(o){if("string"==typeof o.flags&&o.flags.startsWith("#")){let s=await a.Z.adminGroups.getById(o.flags);s&&(o.group=s,t.some(e=>s.flags?.includes(e))||(o.flags=[],o.group=void 0))}else t.some(s=>o.flags?.includes(s))||(o.flags=[],o.group=void 0)}let i=process.env.MASTER_ADMIN===r;return i&&!o&&error("GET /api/auth",`Master admin ${r} not found in database`),e.status(200).json({user:s.user,admin:o,masterAdmin:i})}catch(s){return error("GET /api/auth",s),e.status(400).json({error:"Internal Server Error"})}};t()}catch(s){t(s)}})},6346:(s,e,r)=>{r.a(s,async(s,t)=>{try{r.d(e,{Z:()=>l});var a=r(79649),o=r(45616),i=r(429),n=r.n(i),c=s([o]);o=(c.then?(await c)():c)[0];let u=(0,o.default)();u.use(n()({secret:process.env.SESSION_SECRET||"secret",maxAge:10368e6})),u.use(a.Z.initialize()),u.use(a.Z.session());let l=u;t()}catch(s){t(s)}})},79649:(s,e,r)=>{r.d(e,{Z:()=>n});var t=r(3511),a=r.n(t),o=r(53686);a().serializeUser(async(s,e)=>{e(null,s)}),a().deserializeUser(async(s,e)=>{e(null,s)});let i=process.env.DOMAIN||"";i.startsWith("http")||(i=`https://${i}`),a().use(new o.Strategy({returnURL:`${i}/api/auth/return`,realm:`${i}/`,apiKey:process.env.STEAM_API_KEY||""},(s,e,r)=>(e.identifier=s,r(null,e))));let n=a()}};var e=require("../../webpack-api-runtime.js");e.C(s);var r=s=>e(e.s=s),t=e.X(0,[3337],()=>r(45747));module.exports=t})();