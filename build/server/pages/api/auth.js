"use strict";(()=>{var s={};s.id=4725,s.ids=[4725],s.modules={1428:s=>{s.exports=import("axios")},3250:(s,e,r)=>{r.a(s,async(s,t)=>{try{r.r(e),r.d(e,{default:()=>n});var a=r(19582),i=r(93204),o=s([a,i]);[a,i]=o.then?(await o)():o;let n=async(s,e)=>{await i.A.run(s,e);let{method:r}=s;if(!a.A)return e.status(500).json({message:"Database not connected"});let t=["@css/ban","@css/permban","@css/changemap","@css/kick","@css/rcon","@css/root","@css/chat","@css/cheats","@css/config","@css/config","@css/cvar","@css/generic","@css/kick","@css/kick","@css/password","@css/password","@css/rcon","@css/reservation","@css/reservation","@css/root","@css/root","@css/slay","@css/unban","@css/unban","@css/vote","@web/admingroups","@web/admins","@web/bans","@web/logs","@web/mutes","@web/root","@web/servers","@web/stats","@web/rcon",...(await a.A?.adminFlags.getAll()||[]).map(s=>s.flag)];if("GET"===r)try{if(!s.user)return e.status(401).json({error:"Unauthorized"});let r=s.user.id,i=await a.A.admins.getBySteam64(r);if(i){if("string"==typeof i.flags&&i.flags.startsWith("#")){let s=await a.A.adminGroups.getById(i.flags);s&&(i.group=s,t.some(e=>s.flags?.includes(e))||(i.flags=[],i.group=void 0))}else t.some(s=>i.flags?.includes(s))||(i.flags=[],i.group=void 0)}let o=process.env.MASTER_ADMIN===r;return o&&!i&&error("GET /api/auth",`Master admin ${r} not found in database`),e.status(200).json({user:s.user,admin:i,masterAdmin:o})}catch(s){return error("GET /api/auth",s),e.status(400).json({error:"Internal Server Error"})}};t()}catch(s){t(s)}})},3498:s=>{s.exports=require("mysql2/promise")},10788:s=>{s.exports=import("drizzle-orm/mysql-core")},11737:s=>{s.exports=import("drizzle-orm")},38218:s=>{s.exports=import("steam-api-sdk")},42971:s=>{s.exports=import("zod")},75600:s=>{s.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},76404:s=>{s.exports=import("next-connect")},80169:s=>{s.exports=import("chalk")},80546:s=>{s.exports=import("drizzle-orm/mysql2")},88691:s=>{s.exports=require("cookie-session")},93204:(s,e,r)=>{r.a(s,async(s,t)=>{try{r.d(e,{A:()=>l});var a=r(95621),i=r(76404),o=r(88691),n=r.n(o),c=s([i]);i=(c.then?(await c)():c)[0];let u=(0,i.default)();u.use(n()({secret:process.env.SESSION_SECRET||"secret",maxAge:10368e6})),u.use(a.A.initialize()),u.use(a.A.session());let l=u;t()}catch(s){t(s)}})},93237:(s,e,r)=>{r.a(s,async(s,t)=>{try{r.r(e),r.d(e,{config:()=>l,default:()=>u,routeModule:()=>p});var a=r(13088),i=r(57987),o=r(77355),n=r(3250),c=s([n]);n=(c.then?(await c)():c)[0];let u=(0,o.M)(n,"default"),l=(0,o.M)(n,"config"),p=new a.PagesAPIRouteModule({definition:{kind:i.A.PAGES_API,page:"/api/auth",pathname:"/api/auth",bundlePath:"",filename:""},userland:n});t()}catch(s){t(s)}})},95621:(s,e,r)=>{r.d(e,{A:()=>n});let t=require("passport");var a=r.n(t);let i=require("passport-steam");a().serializeUser(async(s,e)=>{e(null,s)}),a().deserializeUser(async(s,e)=>{e(null,s)});let o=process.env.DOMAIN||"";o.startsWith("http")||(o=`https://${o}`),a().use(new i.Strategy({returnURL:`${o}/api/auth/return`,realm:`${o}/`,apiKey:process.env.STEAM_API_KEY||""},(s,e,r)=>(e.identifier=s,r(null,e))));let n=a()}};var e=require("../../webpack-api-runtime.js");e.C(s);var r=s=>e(e.s=s),t=e.X(0,[937],()=>r(93237));module.exports=t})();