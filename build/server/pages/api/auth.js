"use strict";(()=>{var s={};s.id=2508,s.ids=[2508],s.modules={429:s=>{s.exports=require("cookie-session")},62418:s=>{s.exports=require("mysql2/promise")},20145:s=>{s.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},99648:s=>{s.exports=import("axios")},97564:s=>{s.exports=import("chalk")},45616:s=>{s.exports=import("next-connect")},2782:s=>{s.exports=import("steam-api-sdk")},9926:s=>{s.exports=import("zod")},51199:(s,e,t)=>{t.a(s,async(s,r)=>{try{t.r(e),t.d(e,{config:()=>l,default:()=>u,routeModule:()=>p});var a=t(20114),i=t(32128),n=t(57797),o=t(8395),c=s([o]);o=(c.then?(await c)():c)[0];let u=(0,n.l)(o,"default"),l=(0,n.l)(o,"config"),p=new a.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/auth",pathname:"/api/auth",bundlePath:"",filename:""},userland:o});r()}catch(s){r(s)}})},8395:(s,e,t)=>{t.a(s,async(s,r)=>{try{t.r(e),t.d(e,{default:()=>o});var a=t(48874),i=t(78260),n=s([a,i]);[a,i]=n.then?(await n)():n;let o=async(s,e)=>{await i.Z.run(s,e);let{method:t}=s;if(!a.Z)return e.status(500).json({message:"Database not connected"});let r=["@css/ban","@css/changemap","@css/kick","@css/rcon","@css/root","@css/chat","@css/cheats","@css/config","@css/config","@css/cvar","@css/generic","@css/kick","@css/kick","@css/password","@css/password","@css/rcon","@css/reservation","@css/reservation","@css/root","@css/root","@css/slay","@css/unban","@css/unban","@css/vote","@web/admingroups","@web/admins","@web/bans","@web/logs","@web/mutes","@web/root","@web/servers","@web/stats","@web/rcon",...(await a.Z?.adminFlags.getAll()||[]).map(s=>s.flag)];if("GET"===t)try{if(!s.user)return e.status(401).json({error:"Unauthorized"});let t=s.user.id,i=await a.Z.admins.getBySteam64(t);if(i){if("string"==typeof i.flags&&i.flags.startsWith("#")){let s=await a.Z.adminGroups.getById(i.flags);s&&(i.group=s,r.some(e=>s.flags.includes(e))||(i.flags=[],i.group=void 0))}else r.some(s=>i.flags.includes(s))||(i.flags=[],i.group=void 0)}let n=process.env.MASTER_ADMIN===t;return e.status(200).json({user:s.user,admin:i,masterAdmin:n})}catch(s){return error("GET /api/auth",s),e.status(400).json({error:"Internal Server Error"})}};r()}catch(s){r(s)}})},78260:(s,e,t)=>{t.a(s,async(s,r)=>{try{t.d(e,{Z:()=>l});var a=t(9014),i=t(45616),n=t(429),o=t.n(n),c=s([i]);i=(c.then?(await c)():c)[0];let u=(0,i.default)();u.use(o()({secret:process.env.SESSION_SECRET||"secret",maxAge:10368e6})),u.use(a.Z.initialize()),u.use(a.Z.session());let l=u;r()}catch(s){r(s)}})},9014:(s,e,t)=>{t.d(e,{Z:()=>o});let r=require("passport");var a=t.n(r);let i=require("passport-steam");a().serializeUser(async(s,e)=>{e(null,s)}),a().deserializeUser(async(s,e)=>{e(null,s)});let n=process.env.DOMAIN||"";n.startsWith("http")||(n=`https://${n}`),a().use(new i.Strategy({returnURL:`${n}/api/auth/return`,realm:`${n}/`,apiKey:process.env.STEAM_API_KEY||""},(s,e,t)=>(e.identifier=s,t(null,e))));let o=a()}};var e=require("../../webpack-api-runtime.js");e.C(s);var t=s=>e(e.s=s),r=e.X(0,[6941],()=>t(51199));module.exports=r})();