"use strict";(()=>{var e={};e.id=8709,e.ids=[8709],e.modules={359:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{A:()=>l});var s=a(38218),n=e([s]);s=(n.then?(await n)():n)[0];let i=new Map,l=async e=>{try{let t=[...new Set(e)].filter(e=>!isNaN(Number(e)));if(!t.length)return[];let a=t.filter(e=>i.has(e)),r=t.filter(e=>!i.has(e)),n=a.map(e=>i.get(e)).filter(e=>void 0!==e)||[],l=[];return r.length>0&&(l=await (0,s.From64ToUser)(r,1e3)||[]).forEach(e=>i.set(e.steamid,e)),[...n,...l]}catch(e){return error(`Failed to get steam users ${e}`),[]}};r()}catch(e){r(e)}})},1428:e=>{e.exports=import("axios")},3498:e=>{e.exports=require("mysql2/promise")},5250:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{A:()=>i});var s=a(42971),n=e([s]);let i=(s=(n.then?(await n)():n)[0]).z.object({player_steamid:s.z.string().optional(),player_ip:s.z.string().optional(),reason:s.z.string().min(3),duration:s.z.string(),comment:s.z.string().optional()});r()}catch(e){r(e)}})},5325:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>d,default:()=>u,routeModule:()=>m});var s=a(13088),n=a(57987),i=a(77355),l=a(89458),o=e([l]);l=(o.then?(await o)():o)[0];let u=(0,i.M)(l,"default"),d=(0,i.M)(l,"config"),m=new s.PagesAPIRouteModule({definition:{kind:n.A.PAGES_API,page:"/api/bans",pathname:"/api/bans",bundlePath:"",filename:""},userland:l});r()}catch(e){r(e)}})},10788:e=>{e.exports=import("drizzle-orm/mysql-core")},11737:e=>{e.exports=import("drizzle-orm")},23642:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{A:()=>i});var s=a(19582),n=e([s]);s=(n.then?(await n)():n)[0];let i=async e=>{if(!s.A||!e.user)return!1;let t=e.user.id;return!!await s.A.admins.getBySteam64(t)};r()}catch(e){r(e)}})},38218:e=>{e.exports=import("steam-api-sdk")},41506:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{A:()=>l});var s=a(19582),n=a(96070),i=e([s,n]);[s,n]=i.then?(await i)():i;let l=async(e,t,a,r="discordWebhook")=>{if(s.A)try{s.A.logs.create(e,t,a);let i=await s.A.settings.getByKey(r,!1);i&&"string"==typeof i&&(0,n.A)({url:i,embeds:[{title:`**▬▬▬▬▬ [LOG :: ${e}] ▬▬▬▬▬**`,color:5352959,description:t,timestamp:new Date().toISOString()}]})}catch(e){console.error(`Failed to log: ${e}`)}};r()}catch(e){r(e)}})},42971:e=>{e.exports=import("zod")},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},76404:e=>{e.exports=import("next-connect")},76918:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{A:()=>i});var s=a(42971),n=e([s]);let i=(s=(n.then?(await n)():n)[0]).default.object({page:s.default.string().default("1").refine(e=>!isNaN(Number(e)),{message:"Invalid page query"}).transform(e=>Number(e)),rows:s.default.string().default("10").refine(e=>!isNaN(Number(e)),{message:"Invalid page query"}).refine(e=>50>Number(e),{message:"Rows must be less than 50"}).transform(e=>Number(e)),query:s.default.string().optional()});r()}catch(e){r(e)}})},80169:e=>{e.exports=import("chalk")},80546:e=>{e.exports=import("drizzle-orm/mysql2")},87138:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{A:()=>i});var s=a(19582),n=e([s]);s=(n.then?(await n)():n)[0];let i=(e,t,a,r="AND")=>new Promise(async(n,i)=>{let l;if(!s.A)return t.status(500).json({message:"Database not connected"});if(!e.user)return i(t.status(400).json({success:!1,error:"Protected Route"}));let o=e.user.id,u=await s.A.admins.getBySteam64(o);if(!u)return i(t.status(401).json({success:!1,error:"Protected Route"}));if(!a)return n(u);let d=null;if("object"==typeof u.flags)d=u.flags;else{let e=await s.A.adminGroups.getById(u.flags);e&&(d=e.flags)}if(null===d||!("AND"===r?a.every(e=>d.includes(e)):a.some(e=>d.includes(e))))return i(t.status(403).json({success:!1,error:"Protected Route"}));n(u)});r()}catch(e){r(e)}})},88691:e=>{e.exports=require("cookie-session")},89458:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{default:()=>y});var s=a(38218),n=a(19582),i=a(93204),l=a(76918),o=a(23642),u=a(359),d=a(87138),m=a(5250),c=a(41506),p=e([s,n,i,l,o,u,d,m,c]);[s,n,i,l,o,u,d,m,c]=p.then?(await p)():p;let y=async(e,t)=>{await i.A.run(e,t);let{method:a}=e;if(!n.A)return t.status(500).json({message:"Database not connected"});switch(a){case"GET":{let{page:a,rows:r,query:s}=l.A.parse(e.query),i=await (0,o.A)(e),d=!!await n.A.settings.getByKey("showAdminName",!1)||!!i,m=await n.A.bans.getAll(a,r,s),c=await n.A.bans.count(),p=[...m.map(e=>e.player_steamid),...m.map(e=>e.admin_steamid)].filter(e=>!!e),y=await (0,u.A)(p),f=(await Promise.all(m.map(async e=>{let{admin_name:t,admin_steamid:a,created:r,duration:s,ends:n,id:l,reason:o,status:u,player_name:m,player_steamid:c,server_id:p,comment:f,unban_reason:g,player_ip:A}=e;return{admin_name:d?t:null,admin_steamid:d?a:null,admin_avatar:y.find(e=>e.steamid===a)?.avatar||null,created:r,duration:s,ends:n,id:l,reason:o,status:u,player_name:m,player_steamid:c,player_avatar:y.find(e=>e.steamid===c)?.avatar||null,server_id:p,comment:i?f:null,unban_reason:i?g:null,player_ip:i?A:null}}))).filter(e=>!!e);return t.status(200).json({results:f,count:c})}case"POST":try{let a=await (0,d.A)(e,t);if(!a)return;let{player_steamid:r,player_ip:i,reason:l,duration:o,comment:u}=m.A.parse(e.body),p=null;if(r&&!(p=await (0,s.GetSteamUser)(r)))return t.status(400).send("Invalid player_steamid");let y=new Date,f=new Date(y.getTime()+6e4*Number(o)),g=a.player_name,A=a.player_steamid;return await n.A.bans.create({player_name:p?p.personaname:null,player_steamid:p?p.steamid:null,player_ip:i||null,reason:l,duration:Number(o),comment:u,admin_steamid:A,admin_name:g,created:y,ends:f}),(0,c.A)("Ban Create",`Admin ${e.user?.displayName} (${e.user?.id}) banned "${p?.personaname}" (${r}) with reason: ${l} and duration: ${o} minutes`,e.user?.id,"adminCommandsDiscordWebhook"),t.status(201).json({message:"Ban created"})}catch(e){return t.status(400).json({error:e})}}};r()}catch(e){r(e)}})},93204:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{A:()=>d});var s=a(95621),n=a(76404),i=a(88691),l=a.n(i),o=e([n]);n=(o.then?(await o)():o)[0];let u=(0,n.default)();u.use(l()({secret:process.env.SESSION_SECRET||"secret",maxAge:10368e6})),u.use(s.A.initialize()),u.use(s.A.session());let d=u;r()}catch(e){r(e)}})},95621:(e,t,a)=>{a.d(t,{A:()=>l});let r=require("passport");var s=a.n(r);let n=require("passport-steam");s().serializeUser(async(e,t)=>{t(null,e)}),s().deserializeUser(async(e,t)=>{t(null,e)});let i=process.env.DOMAIN||"";i.startsWith("http")||(i=`https://${i}`),s().use(new n.Strategy({returnURL:`${i}/api/auth/return`,realm:`${i}/`,apiKey:process.env.STEAM_API_KEY||""},(e,t,a)=>(t.identifier=e,a(null,t))));let l=s()}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[937],()=>a(5325));module.exports=r})();