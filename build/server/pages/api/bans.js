"use strict";(()=>{var e={};e.id=9074,e.ids=[9074],e.modules={429:e=>{e.exports=require("cookie-session")},62418:e=>{e.exports=require("mysql2/promise")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},99648:e=>{e.exports=import("axios")},97564:e=>{e.exports=import("chalk")},45616:e=>{e.exports=import("next-connect")},2782:e=>{e.exports=import("steam-api-sdk")},9926:e=>{e.exports=import("zod")},17049:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{config:()=>d,default:()=>o,routeModule:()=>c});var r=a(88667),n=a(25828),i=a(38051),l=a(89088),u=e([l]);l=(u.then?(await u)():u)[0];let o=(0,i.l)(l,"default"),d=(0,i.l)(l,"config"),c=new r.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/bans",pathname:"/api/bans",bundlePath:"",filename:""},userland:l});s()}catch(e){s(e)}})},89088:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{default:()=>y});var r=a(2782),n=a(6995),i=a(74186),l=a(8909),u=a(77028),o=a(59788),d=a(73153),c=a(58111),m=a(45878),p=e([r,n,i,l,u,o,d,c,m]);[r,n,i,l,u,o,d,c,m]=p.then?(await p)():p;let y=async(e,t)=>{await i.Z.run(e,t);let{method:a}=e;if(!n.Z)return t.status(500).json({message:"Database not connected"});switch(a){case"GET":{let{page:a,rows:s}=l.Z.parse(e.query),r=await (0,u.Z)(e),i=!!await n.Z.settings.getByKey("showAdminName",!1)||!!r,d=await n.Z.bans.getAll(a,s),c=await n.Z.bans.count(),m=[...d.map(e=>e.player_steamid),...d.map(e=>e.admin_steamid)].filter(e=>!!e),p=await (0,o.Z)(m),y=(await Promise.all(d.map(async e=>{let{admin_name:t,admin_steamid:a,created:s,duration:n,ends:l,id:u,reason:o,status:d,player_name:c,player_steamid:m,server_id:y,comment:f,unban_reason:g,player_ip:w}=e;return{admin_name:i?t:null,admin_steamid:i?a:null,admin_avatar:p.find(e=>e.steamid===a)?.avatar||null,created:s,duration:n,ends:l,id:u,reason:o,status:d,player_name:c,player_steamid:m,player_avatar:p.find(e=>e.steamid===m)?.avatar||null,server_id:y,comment:r?f:null,unban_reason:r?g:null,player_ip:w}}))).filter(e=>!!e);return t.status(200).json({results:y,count:c})}case"POST":try{let a=await (0,d.Z)(e,t);if(!a)return;let{player_steamid:s,player_ip:i,reason:l,duration:u,comment:o}=c.Z.parse(e.body),p=null;if(s&&!(p=await (0,r.GetSteamUser)(s)))return t.status(400).send("Invalid player_steamid");let y=new Date,f=new Date(y.getTime()+6e4*Number(u)),g=a.player_name,w=a.player_steamid;return await n.Z.bans.create({player_name:p?p.personaname:null,player_steamid:p?p.steamid:null,player_ip:i||null,reason:l,duration:Number(u),comment:o,admin_steamid:w,admin_name:g,created:y,ends:f}),(0,m.Z)("Ban Create",`Admin ${e.user?.displayName} (${e.user?.id}) banned "${p?.personaname}" (${s}) with reason: ${l} and duration: ${u} minutes`,e.user?.id),t.status(201).json({message:"Ban created"})}catch(e){return t.status(400).json({error:e})}}};s()}catch(e){s(e)}})},59788:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.d(t,{Z:()=>i});var r=a(2782),n=e([r]);r=(n.then?(await n)():n)[0];let i=async e=>{let t=[...new Set(e)].filter(e=>!isNaN(Number(e)));return t.length&&await (0,r.From64ToUser)(t)||[]};s()}catch(e){s(e)}})},77028:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.d(t,{Z:()=>i});var r=a(6995),n=e([r]);r=(n.then?(await n)():n)[0];let i=async e=>{if(!r.Z||!e.user)return!1;let t=e.user.id;return!!await r.Z.admins.getBySteam64(t)};s()}catch(e){s(e)}})},45878:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.d(t,{Z:()=>l});var r=a(6995),n=a(899),i=e([r,n]);[r,n]=i.then?(await i)():i;let l=async(e,t,a)=>{if(r.Z)try{r.Z.logs.create(e,t,a);let s=await r.Z.settings.getByKey("discordWebhook",!1);s&&(0,n.Z)({url:s,embeds:[{title:`**▬▬▬▬▬ [LOG :: ${e}] ▬▬▬▬▬**`,color:5352959,description:t,timestamp:new Date().toISOString()}]})}catch(e){console.error(`Failed to log: ${e}`)}};s()}catch(e){s(e)}})},74186:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.d(t,{Z:()=>d});var r=a(15313),n=a(45616),i=a(429),l=a.n(i),u=e([n]);n=(u.then?(await u)():u)[0];let o=(0,n.default)();o.use(l()({secret:process.env.SESSION_SECRET||"secret",maxAge:10368e6})),o.use(r.Z.initialize()),o.use(r.Z.session());let d=o;s()}catch(e){s(e)}})},15313:(e,t,a)=>{a.d(t,{Z:()=>l});let s=require("passport");var r=a.n(s);let n=require("passport-steam");r().serializeUser(async(e,t)=>{t(null,e)}),r().deserializeUser(async(e,t)=>{t(null,e)});let i=process.env.DOMAIN||"";i.startsWith("http")||(i=`https://${i}`),r().use(new n.Strategy({returnURL:`${i}/api/auth/return`,realm:`${i}/`,apiKey:process.env.STEAM_API_KEY||"",stateless:!0},(e,t,a)=>(t.identifier=e,a(null,t))));let l=r()},73153:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.d(t,{Z:()=>i});var r=a(6995),n=e([r]);r=(n.then?(await n)():n)[0];let i=(e,t,a,s="AND")=>new Promise(async(n,i)=>{if(!r.Z)return t.status(500).json({message:"Database not connected"});if(!e.user)return i(t.status(400).json({success:!1,error:"Protected Route"}));let l=e.user.id,u=await r.Z.admins.getBySteam64(l);if(!u)return i(t.status(401).json({success:!1,error:"Protected Route"}));if(!a)return n(u);let o=null;if("object"==typeof u.flags)o=u.flags;else{let e=await r.Z.adminGroups.getById(u.flags);e&&(o=e.flags)}if(null===o||!("AND"===s?a.every(e=>o.includes(e)):a.some(e=>o.includes(e))))return i(t.status(403).json({success:!1,error:"Protected Route"}));n(u)});s()}catch(e){s(e)}})},58111:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.d(t,{Z:()=>i});var r=a(9926),n=e([r]);let i=(r=(n.then?(await n)():n)[0]).z.object({player_steamid:r.z.string().optional(),player_ip:r.z.string().optional(),reason:r.z.string().min(3),duration:r.z.string(),comment:r.z.string().optional()});s()}catch(e){s(e)}})},8909:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.d(t,{Z:()=>i});var r=a(9926),n=e([r]);let i=(r=(n.then?(await n)():n)[0]).default.object({page:r.default.string().default("1").refine(e=>!isNaN(Number(e)),{message:"Invalid page query"}).transform(e=>Number(e)),rows:r.default.string().default("10").refine(e=>!isNaN(Number(e)),{message:"Invalid page query"}).refine(e=>50>Number(e),{message:"Rows must be less than 50"}).transform(e=>Number(e)),query:r.default.string().optional()});s()}catch(e){s(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[6037],()=>a(17049));module.exports=s})();