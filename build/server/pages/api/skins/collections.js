"use strict";(()=>{var e={};e.id=1313,e.ids=[1313],e.modules={429:e=>{e.exports=require("cookie-session")},62418:e=>{e.exports=require("mysql2/promise")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3511:e=>{e.exports=require("passport")},53686:e=>{e.exports=require("passport-steam")},99648:e=>{e.exports=import("axios")},97564:e=>{e.exports=import("chalk")},97612:e=>{e.exports=import("drizzle-orm")},99089:e=>{e.exports=import("drizzle-orm/mysql-core")},63024:e=>{e.exports=import("drizzle-orm/mysql2")},45616:e=>{e.exports=import("next-connect")},2782:e=>{e.exports=import("steam-api-sdk")},9926:e=>{e.exports=import("zod")},53696:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>d,default:()=>l,routeModule:()=>m});var s=a(71802),n=a(47153),i=a(56249),o=a(75226),u=e([o]);o=(u.then?(await u)():u)[0];let l=(0,i.l)(o,"default"),d=(0,i.l)(o,"config"),m=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/skins/collections",pathname:"/api/skins/collections",bundlePath:"",filename:""},userland:o});r()}catch(e){r(e)}})},75226:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{default:()=>g});var s=a(22692),n=a(99863),i=a(39514),o=a(89417),u=a(78270),l=a(73253),d=a(34607),m=a(79173),c=a(6346),p=a(17011),f=e([n,i,o,u,l,d,m,c,p]);[n,i,o,u,l,d,m,c,p]=f.then?(await f)():f;let g=async(e,t)=>{if(!m.Z)return t.status(500).json({message:"Database not connected"});if(!(await (0,n.ed)("skins-collections")).enabled)return t.status(404).json({message:"Module not found"});await c.Z.run(e,t);let{method:a}=e;switch(a){case"GET":try{let a=e.user,{page:r,rows:s,query:n,sort:i}=l.Z.parse(e.query),{filter:o}=e.query||{filter:"ALL"},u="MINE"===o&&a?await (0,p.EH)(a.id,i):await (0,p.Cz)(r||1,s||10,n,i),m=u.map(e=>e.steamid),c=await (0,d.Z)(m),f=u.map(e=>{let t=c.find(t=>t.steamid===e.steamid);return{...e,steam:t}}).filter(Boolean),g=await (0,p.dm)(n);return t.status(200).json({results:f,count:g})}catch(e){return console.error(e),t.status(500).json({message:"Internal server error"})}case"POST":{let{name:a}=e.body;if(!a)return t.status(400).json({message:"Name is required"});let r=await (0,o.Z)(e,t);if(!r)return;if((await (0,p.EH)(r.id)).length>=3)return t.status(400).json({message:"You can only have 3 collections"});let{agents:n,gloves:u,knife:l,music:d,skins:m,pins:c}=await (0,i.R)(r.id);if(0===m.length)return t.status(400).json({message:"You need to have skins to create a collection"});let f=m.filter(e=>!s.ku.filter(e=>!e.name.includes("Gloves")).find(t=>Number(t.weapon_defindex)===e.weapon_defindex)||!!s.g8.find(t=>t.weapon_defindex===e.weapon_defindex&&Number(t.paint_index)===e.weapon_paint_id));return await (0,p.UQ)(r.id,a,{agents:n,gloves:u,knife:l,music:d,skins:f,pins:c}),t.status(200).json({message:"Collection created"})}case"PATCH":try{let a=await (0,o.Z)(e,t);if(!a)return;if((await (0,p.EH)(a.id)).length>=3)return t.status(400).json({message:"You can only have 3 collections"});let r=u.Z.parse(e.body);return await (0,p.UQ)(a.id,r.name,r),t.status(200).json({message:"Collection set"})}catch(e){return console.error(e),t.status(500).json({message:"Internal server error"})}}};r()}catch(e){r(e)}})},34607:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{Z:()=>o});var s=a(2782),n=e([s]);s=(n.then?(await n)():n)[0];let i=new Map,o=async e=>{try{let t=[...new Set(e)].filter(e=>!isNaN(Number(e)));if(!t.length)return[];let a=t.filter(e=>i.has(e)),r=t.filter(e=>!i.has(e)),n=a.map(e=>i.get(e)).filter(e=>void 0!==e)||[],o=[];return r.length>0&&(o=await (0,s.From64ToUser)(r,1e3)||[]).forEach(e=>i.set(e.steamid,e)),[...n,...o]}catch(e){return error(`Failed to get steam users ${e}`),[]}};r()}catch(e){r(e)}})},78270:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{Z:()=>i});var s=a(9926),n=e([s]);let i=(s=(n.then?(await n)():n)[0]).z.object({name:s.z.string(),agents:s.z.object({steamid:s.z.string(),agent_ct:s.z.string().nullable(),agent_t:s.z.string().nullable()}),gloves:s.z.object({steamid:s.z.string(),weapon_defindex:s.z.number(),weapon_team:s.z.number()}),knife:s.z.object({steamid:s.z.string(),knife:s.z.string(),weapon_team:s.z.number()}),music:s.z.object({steamid:s.z.string(),music_id:s.z.number(),weapon_team:s.z.number()}),pins:s.z.array(s.z.object({steamid:s.z.string(),id:s.z.number(),weapon_team:s.z.number()})),skins:s.z.array(s.z.object({steamid:s.z.string(),weapon_defindex:s.z.number(),weapon_paint_id:s.z.number(),weapon_wear:s.z.number(),weapon_seed:s.z.number()}))});r()}catch(e){r(e)}})},73253:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{Z:()=>i});var s=a(9926),n=e([s]);let i=(s=(n.then?(await n)():n)[0]).default.object({page:s.default.string().default("1").refine(e=>!Number.isNaN(Number(e)),{message:"Invalid page query"}).transform(e=>Number(e)),rows:s.default.string().default("10").refine(e=>!Number.isNaN(Number(e)),{message:"Invalid page query"}).refine(e=>50>Number(e),{message:"Rows must be less than 50"}).transform(e=>Number(e)),query:s.default.string().optional(),filter:s.default.string().default("ALL"),sort:s.default.optional(s.default.string().default("CRAETED"))});r()}catch(e){r(e)}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[3337,6839],()=>a(53696));module.exports=r})();