"use strict";(()=>{var e={};e.id=7521,e.ids=[7521],e.modules={43582:e=>{e.exports=require("@fabricio-191/valve-server-query")},429:e=>{e.exports=require("cookie-session")},62418:e=>{e.exports=require("mysql2/promise")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3511:e=>{e.exports=require("passport")},53686:e=>{e.exports=require("passport-steam")},99648:e=>{e.exports=import("axios")},97564:e=>{e.exports=import("chalk")},97612:e=>{e.exports=import("drizzle-orm")},99089:e=>{e.exports=import("drizzle-orm/mysql-core")},63024:e=>{e.exports=import("drizzle-orm/mysql2")},45616:e=>{e.exports=import("next-connect")},2782:e=>{e.exports=import("steam-api-sdk")},9926:e=>{e.exports=import("zod")},72319:(e,a,r)=>{r.a(e,async(e,s)=>{try{r.r(a),r.d(a,{config:()=>w,default:()=>_,routeModule:()=>c});var t=r(71802),n=r(47153),i=r(56249),o=r(92340),p=e([o]);o=(p.then?(await p)():p)[0];let _=(0,i.l)(o,"default"),w=(0,i.l)(o,"config"),c=new t.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/skins/weapons/unequip",pathname:"/api/skins/weapons/unequip",bundlePath:"",filename:""},userland:o});s()}catch(e){s(e)}})},92340:(e,a,r)=>{r.a(e,async(e,s)=>{try{r.r(a),r.d(a,{default:()=>c});var t=r(13744),n=r(7707),i=r(99863),o=r(89417),p=r(79173),_=r(6346),w=e([t,n,i,o,p,_]);[t,n,i,o,p,_]=w.then?(await w)():w;let c=async(e,a)=>{if(!p.Z)return a.status(500).json({message:"Database not connected"});if(!(await (0,i.ed)("skins")).enabled)return a.status(404).json({message:"Module not found"});await _.Z.run(e,a);let{method:r}=e,s=await (0,o.Z)(e,a);if(s&&"DELETE"===r)try{let{weapon_defindex:r,weapon_team:i}=e.body;return await (0,t.YE)(s.id,r,i),(0,n.x)(`css_fexec ${s.id} css_wp`),a.status(201).end()}catch(e){return console.error(e),a.status(500).json({message:"Internal server error"})}};s()}catch(e){s(e)}})},7707:(e,a,r)=>{r.a(e,async(e,s)=>{try{r.d(a,{Z:()=>_,x:()=>p});var t=r(43582),n=r(79173),i=e([n]);n=(i.then?(await i)():i)[0];let o=async(e,a)=>{if(!n.Z)throw Error("Database not connected");try{let r=await n.Z.servers.getById(Number(e));if(!r)throw Error("Server not found");let{address:s,rcon:i}=r,[o,p]=s.split(":");if(!i)throw Error("Server has no rcon password");let _=await (0,t.RCON)({ip:o,port:Number(p),password:i,enableWarns:!0,retries:2,timeout:2e3});_.authenticate();let w=await _.exec(a);if(!w)return"No response from server";return w}catch(e){throw warn(`Error while sending rcon command: ${e}`),e}},p=async e=>{if(!n.Z)throw Error("Database not connected");let a=await n.Z.servers.getAll();return await Promise.all(a.map(async a=>{try{let r=await o(a.id,e);return{server:a.hostname,response:r}}catch(e){return{server:a.hostname,response:e}}}))},_=o;s()}catch(e){s(e)}})},6346:(e,a,r)=>{r.a(e,async(e,s)=>{try{r.d(a,{Z:()=>w});var t=r(79649),n=r(45616),i=r(429),o=r.n(i),p=e([n]);n=(p.then?(await p)():p)[0];let _=(0,n.default)();_.use(o()({secret:process.env.SESSION_SECRET||"secret",maxAge:10368e6})),_.use(t.Z.initialize()),_.use(t.Z.session());let w=_;s()}catch(e){s(e)}})},79649:(e,a,r)=>{r.d(a,{Z:()=>o});var s=r(3511),t=r.n(s),n=r(53686);t().serializeUser(async(e,a)=>{a(null,e)}),t().deserializeUser(async(e,a)=>{a(null,e)});let i=process.env.DOMAIN||"";i.startsWith("http")||(i=`https://${i}`),t().use(new n.Strategy({returnURL:`${i}/api/auth/return`,realm:`${i}/`,apiKey:process.env.STEAM_API_KEY||""},(e,a,r)=>(a.identifier=e,r(null,a))));let o=t()},89417:(e,a,r)=>{r.a(e,async(e,s)=>{try{r.d(a,{Z:()=>i});var t=r(79173),n=e([t]);t=(n.then?(await n)():n)[0];let i=(e,a)=>new Promise(async(r,s)=>t.Z?e.user?void r(e.user):s(a.status(400).json({success:!1,error:"Protected Route"})):a.status(500).json({message:"Database not connected"}));s()}catch(e){s(e)}})},13744:(e,a,r)=>{r.a(e,async(e,s)=>{try{r.d(a,{YE:()=>c,jx:()=>_,xI:()=>w});var t=r(22692),n=r(3929),i=r(97612),o=r(48057),p=e([n,i,o]);[n,i,o]=p.then?(await p)():p;let _=async e=>{if(!o.of)throw Error("No mysql connection");try{return(await o.of.query.wp_player_skins.findMany({where:(0,i.eq)(n.wp_player_skins.steamid,e)})||[{weapon_defindex:0,weapon_paint_id:0,weapon_seed:0,weapon_wear:1e-6,steamid:e}]).map(e=>({...e,weapon_sticker_0:(0,t.qQ)(e.weapon_sticker_0),weapon_sticker_1:(0,t.qQ)(e.weapon_sticker_1),weapon_sticker_2:(0,t.qQ)(e.weapon_sticker_2),weapon_sticker_3:(0,t.qQ)(e.weapon_sticker_3),weapon_sticker_4:(0,t.qQ)(e.weapon_sticker_4),weapon_keychain:(0,t.P_)(e.weapon_keychain)}))}catch(e){return console.error(e),[]}},w=async({steamid:e,weapon_defindex:a,weapon_wear:r,weapon_team:s,...p})=>{if(!o.of)throw Error("No mysql connection");try{if(0===s)console.debug("SetPlayerSkin","weapon_team is 0, removing all skins with the same defindex"),await o.of.delete(n.wp_player_skins).where((0,i.and)((0,i.eq)(n.wp_player_skins.steamid,e),(0,i.eq)(n.wp_player_skins.weapon_defindex,a)));else{let r=await o.of.select().from(n.wp_player_skins).where((0,i.and)((0,i.eq)(n.wp_player_skins.steamid,e),(0,i.eq)(n.wp_player_skins.weapon_defindex,a)));console.debug("SetPlayerSkin","weapon_team is not 0, removing all skins with the same defindex and team"),await o.of.delete(n.wp_player_skins).where((0,i.and)((0,i.eq)(n.wp_player_skins.steamid,e),(0,i.eq)(n.wp_player_skins.weapon_defindex,a),(0,i.eq)(n.wp_player_skins.weapon_team,s)));let t=r.some(e=>0===e.weapon_team),p=r.some(e=>0!==e.weapon_team&&e.weapon_team!==s);console.log({hasTeam0:t,hasOppositeTeam:p,itemSkins:r}),t&&p?(console.debug("SetPlayerSkin","removing team 0 skin"),await o.of.delete(n.wp_player_skins).where((0,i.and)((0,i.eq)(n.wp_player_skins.steamid,e),(0,i.eq)(n.wp_player_skins.weapon_defindex,a),(0,i.eq)(n.wp_player_skins.weapon_team,0)))):t&&await o.of.update(n.wp_player_skins).set({weapon_team:2===s?3:2}).where((0,i.and)((0,i.eq)(n.wp_player_skins.steamid,e),(0,i.eq)(n.wp_player_skins.weapon_defindex,a),(0,i.eq)(n.wp_player_skins.weapon_team,0)))}let[_]=await o.of.update(n.wp_player_skins).set({...p,weapon_wear:0===r?0:r,weapon_keychain:(0,t.Ky)(p.weapon_keychain),weapon_sticker_0:(0,t.i1)(p.weapon_sticker_0),weapon_sticker_1:(0,t.i1)(p.weapon_sticker_1),weapon_sticker_2:(0,t.i1)(p.weapon_sticker_2),weapon_sticker_3:(0,t.i1)(p.weapon_sticker_3),weapon_sticker_4:(0,t.i1)(p.weapon_sticker_4)}).where((0,i.and)((0,i.eq)(n.wp_player_skins.steamid,e),(0,i.eq)(n.wp_player_skins.weapon_defindex,a),0===s?void 0:(0,i.eq)(n.wp_player_skins.weapon_team,s)));0===_.affectedRows&&await o.of.insert(n.wp_player_skins).values({...p,steamid:e,weapon_defindex:a,weapon_team:s,weapon_wear:0===r?0:r,weapon_keychain:(0,t.Ky)(p.weapon_keychain),weapon_sticker_0:(0,t.i1)(p.weapon_sticker_0),weapon_sticker_1:(0,t.i1)(p.weapon_sticker_1),weapon_sticker_2:(0,t.i1)(p.weapon_sticker_2),weapon_sticker_3:(0,t.i1)(p.weapon_sticker_3),weapon_sticker_4:(0,t.i1)(p.weapon_sticker_4)})}catch(e){throw Error(`Failed to set player skin ${e}`)}},c=async(e,a,r)=>{if(!o.of)throw Error("No mysql connection");try{await o.of.delete(n.wp_player_skins).where((0,i.and)((0,i.eq)(n.wp_player_skins.steamid,e),(0,i.eq)(n.wp_player_skins.weapon_defindex,a),(0,i.eq)(n.wp_player_skins.weapon_team,r)))}catch(e){throw Error("Failed to delete player skin")}};s()}catch(e){s(e)}})}};var a=require("../../../../webpack-api-runtime.js");a.C(e);var r=e=>a(a.s=e),s=a.X(0,[3337],()=>r(72319));module.exports=s})();