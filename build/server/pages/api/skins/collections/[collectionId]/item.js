"use strict";(()=>{var e={};e.id=5759,e.ids=[5759],e.modules={429:e=>{e.exports=require("cookie-session")},62418:e=>{e.exports=require("mysql2/promise")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3511:e=>{e.exports=require("passport")},53686:e=>{e.exports=require("passport-steam")},99648:e=>{e.exports=import("axios")},97564:e=>{e.exports=import("chalk")},97612:e=>{e.exports=import("drizzle-orm")},99089:e=>{e.exports=import("drizzle-orm/mysql-core")},63024:e=>{e.exports=import("drizzle-orm/mysql2")},45616:e=>{e.exports=import("next-connect")},2782:e=>{e.exports=import("steam-api-sdk")},9926:e=>{e.exports=import("zod")},50333:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{config:()=>d,default:()=>c,routeModule:()=>p});var s=r(71802),i=r(47153),n=r(56249),a=r(19590),l=e([a]);a=(l.then?(await l)():l)[0];let c=(0,n.l)(a,"default"),d=(0,n.l)(a,"config"),p=new s.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/skins/collections/[collectionId]/item",pathname:"/api/skins/collections/[collectionId]/item",bundlePath:"",filename:""},userland:a});o()}catch(e){o(e)}})},19590:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{default:()=>p});var s=r(22692),i=r(17011),n=r(99863),a=r(89417),l=r(79173),c=r(6346),d=e([i,n,a,l,c]);[i,n,a,l,c]=d.then?(await d)():d;let p=async(e,t)=>{if(!l.Z)return t.status(500).json({message:"Database not connected"});if(!(await (0,n.ed)("skins-collections")).enabled)return t.status(404).json({message:"Module not found"});await c.Z.run(e,t);let{method:r}=e,{collectionId:o}=e.query,d=await (0,i.U9)(Number(o));if(!d)return t.status(404).json({message:"Collection not found"});let p=await (0,a.Z)(e,t);if(p){if(p.id!==d.steamid)return t.status(403).json({message:"Forbidden"});if("DELETE"===r)try{switch(e.body.type){case"SKIN":{let{weapon_id:r,weapon_paint_id:n}=e.body,a=s.DA.find(e=>e.weapons.find(e=>e.id===r));if(a?.name==="Gloves"){let e=s.ku.find(e=>e.id===r)?.weapon_defindex;if(!e)return t.status(404).json({message:"Weapon not found"});let a=d.json,l=a.skins?.filter(t=>t.weapon_defindex!==e||t.weapon_paint_id!==n)||[];l.map(e=>{"weapon_sticker_0"in e&&e.weapon_sticker_0&&"string"!=typeof e.weapon_sticker_0&&(e.weapon_sticker_0=(0,s.i1)(e.weapon_sticker_0)),"weapon_sticker_1"in e&&e.weapon_sticker_1&&"string"!=typeof e.weapon_sticker_1&&(e.weapon_sticker_1=(0,s.i1)(e.weapon_sticker_1)),"weapon_sticker_2"in e&&e.weapon_sticker_2&&"string"!=typeof e.weapon_sticker_2&&(e.weapon_sticker_2=(0,s.i1)(e.weapon_sticker_2)),"weapon_sticker_3"in e&&e.weapon_sticker_3&&"string"!=typeof e.weapon_sticker_3&&(e.weapon_sticker_3=(0,s.i1)(e.weapon_sticker_3)),"weapon_sticker_4"in e&&e.weapon_sticker_4&&"string"!=typeof e.weapon_sticker_4&&(e.weapon_sticker_4=(0,s.i1)(e.weapon_sticker_4)),"weapon_keychain"in e&&e.weapon_keychain&&"string"!=typeof e.weapon_keychain&&(e.weapon_keychain=(0,s.Ky)(e.weapon_keychain))});let c={...a,skins:l,gloves:null};await (0,i.YR)(Number(o),d.name,c)}else{let e=s.ku.find(e=>e.id===r)?.weapon_defindex;if(!e)return t.status(404).json({message:"Weapon not found"});let a=d.json,l={...a,skins:a.skins?.filter(t=>t.weapon_defindex!==e||t.weapon_paint_id!==n)||[]};if(l.skins.length<4)return t.status(400).json({message:"You need at least 4 skins in your collection"});await (0,i.YR)(Number(o),d.name,l)}break}case"MUSIC_KIT":{let e={...d.json,music:null};await (0,i.YR)(Number(o),d.name,e);break}case"PIN":{let e={...d.json,pins:null};await (0,i.YR)(Number(o),d.name,e);break}case"AGENT":{let t=d.json,r={...t,agents:{...t.agents,[e.body.team]:null}};await (0,i.YR)(Number(o),d.name,r)}}return t.status(200).json({message:"Collection item deleted"})}catch(e){return console.error(e),t.status(500).json({message:"Internal server error"})}}};o()}catch(e){o(e)}})},6346:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.d(t,{Z:()=>d});var s=r(79649),i=r(45616),n=r(429),a=r.n(n),l=e([i]);i=(l.then?(await l)():l)[0];let c=(0,i.default)();c.use(a()({secret:process.env.SESSION_SECRET||"secret",maxAge:10368e6})),c.use(s.Z.initialize()),c.use(s.Z.session());let d=c;o()}catch(e){o(e)}})},79649:(e,t,r)=>{r.d(t,{Z:()=>a});var o=r(3511),s=r.n(o),i=r(53686);s().serializeUser(async(e,t)=>{t(null,e)}),s().deserializeUser(async(e,t)=>{t(null,e)});let n=process.env.DOMAIN||"";n.startsWith("http")||(n=`https://${n}`),s().use(new i.Strategy({returnURL:`${n}/api/auth/return`,realm:`${n}/`,apiKey:process.env.STEAM_API_KEY||""},(e,t,r)=>(t.identifier=e,r(null,t))));let a=s()},89417:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.d(t,{Z:()=>n});var s=r(79173),i=e([s]);s=(i.then?(await i)():i)[0];let n=(e,t)=>new Promise(async(r,o)=>s.Z?e.user?void r(e.user):o(t.status(400).json({success:!1,error:"Protected Route"})):t.status(500).json({message:"Database not connected"}));o()}catch(e){o(e)}})},17011:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.d(t,{Cz:()=>_,EH:()=>c,U9:()=>d,UQ:()=>k,YR:()=>u,dm:()=>m,fe:()=>p,sl:()=>w});var s=r(3929),i=r(97612),n=r(48057),a=r(78779),l=e([s,i,n,a]);[s,i,n,a]=l.then?(await l)():l;let c=async(e,t="CREATED")=>{if(!n.of)throw Error("No mysql connection");try{let r=(0,i.sql)`${a.Z.id} DESC`;switch(t){case"LIKES":r=(0,i.sql)`LENGTH(${a.Z.likes}) - LENGTH(REPLACE(${a.Z.likes}, ',', '')) DESC, ${a.Z.id} DESC`;break;case"CREATED":r=(0,i.sql)`${a.Z.id} DESC`}return(await n.of.select({id:a.Z.id,name:a.Z.name,steamid:a.Z.steamid,json:a.Z.json,likes:a.Z.likes,likes_count:(0,i.sql)`LENGTH(${a.Z.likes}) - LENGTH(REPLACE(${a.Z.likes}, ',', '')) as likes_count`,created_at:a.Z.created_at}).from(a.Z).where((0,i.eq)(s.wp_player_collections.steamid,e)).orderBy(r)).map(e=>({...e,json:JSON.parse(e.json),likes:JSON.parse(e.likes)}))}catch(e){return console.error(e),[]}},d=async e=>{if(!n.of)throw Error("No mysql connection");try{let t=await n.of.query.wp_player_collections.findFirst({where:(0,i.eq)(s.wp_player_collections.id,e)});if(!t)throw Error("Collection not found");return{...t,json:JSON.parse(t.json),likes:JSON.parse(t.likes)}}catch(e){throw console.error(`Error while getting collection by ID: ${e}`),Error("Collection not found")}},p=async e=>{if(!n.of)throw Error("No mysql connection");try{await n.of.delete(a.Z).where((0,i.eq)(s.wp_player_collections.id,e))}catch(e){throw console.error(`Error while deleting collection: ${e}`),Error("Failed to delete collection")}},u=async(e,t,r)=>{if(!n.of)throw Error("No mysql connection");try{await n.of.update(a.Z).set({json:JSON.stringify(r),name:t}).where((0,i.eq)(a.Z.id,e))}catch(e){throw console.error(`Error while updating collection: ${e}`),Error("Failed to update collection")}},w=async(e,t)=>{if(!n.of)throw Error("No mysql connection");try{await n.of.update(a.Z).set({likes:JSON.stringify(t)}).where((0,i.eq)(a.Z.id,e))}catch(e){throw console.error(`Error while updating collection likes: ${e}`),Error("Failed to update collection likes")}},_=async(e,t,r,o="CREATED")=>{if(!n.of)throw Error("No mysql connection");try{let s=r&&r.length>2?(0,i.or)((0,i.like)(a.Z.name,`%${r}%`),(0,i.like)(a.Z.steamid,`%${r}%`),(0,i.like)(a.Z.id,`%${r}%`)):void 0,l=(0,i.sql)`${a.Z.id} DESC`;switch(o){case"LIKES":l=(0,i.sql)`LENGTH(${a.Z.likes}) - LENGTH(REPLACE(${a.Z.likes}, ',', '')) DESC, ${a.Z.id} DESC`;break;case"CREATED":l=(0,i.sql)`${a.Z.id} DESC`}return(await n.of.select({id:a.Z.id,name:a.Z.name,steamid:a.Z.steamid,json:a.Z.json,likes:a.Z.likes,likes_count:(0,i.sql)`LENGTH(${a.Z.likes}) - LENGTH(REPLACE(${a.Z.likes}, ',', '')) as likes_count`,created_at:a.Z.created_at}).from(a.Z).where(s).orderBy(l).limit(t).offset((e-1)*t)).map(e=>({...e,json:JSON.parse(e.json),likes:JSON.parse(e.likes)}))}catch(e){return console.error(`[DB] Error while getting all skins collections: ${e}`),[]}},m=async e=>{if(!n.of)throw Error("No mysql connection");try{let t=e?(0,i.or)((0,i.like)(a.Z.steamid,`%${e}%`),(0,i.like)(a.Z.id,`%${e}%`)):void 0,[r]=await n.of.select({count:(0,i.sql)`COUNT(*)`}).from(a.Z).where(t);return r?.count??0}catch(e){return console.error(`[DB] Error while counting skins collections: ${e}`),0}},k=async(e,t,r)=>{if(!n.of)throw Error("No mysql connection");try{await n.of.insert(a.Z).values({steamid:e,name:t,json:JSON.stringify(r)})}catch(e){throw console.error(`Error while creating a new collection: ${e}`),Error("Failed to create a new collection")}};o()}catch(e){o(e)}})}};var t=require("../../../../../webpack-api-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[3337],()=>r(50333));module.exports=o})();