"use strict";(()=>{var e={};e.id=5434,e.ids=[5434],e.modules={429:e=>{e.exports=require("cookie-session")},62418:e=>{e.exports=require("mysql2/promise")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3511:e=>{e.exports=require("passport")},53686:e=>{e.exports=require("passport-steam")},99648:e=>{e.exports=import("axios")},97564:e=>{e.exports=import("chalk")},97612:e=>{e.exports=import("drizzle-orm")},99089:e=>{e.exports=import("drizzle-orm/mysql-core")},63024:e=>{e.exports=import("drizzle-orm/mysql2")},45616:e=>{e.exports=import("next-connect")},2782:e=>{e.exports=import("steam-api-sdk")},9926:e=>{e.exports=import("zod")},67411:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{config:()=>d,default:()=>c,routeModule:()=>u});var s=t(71802),i=t(47153),n=t(56249),a=t(51524),l=e([a]);a=(l.then?(await l)():l)[0];let c=(0,n.l)(a,"default"),d=(0,n.l)(a,"config"),u=new s.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/skins/collections/[collectionId]/like",pathname:"/api/skins/collections/[collectionId]/like",bundlePath:"",filename:""},userland:a});o()}catch(e){o(e)}})},51524:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{default:()=>d});var s=t(17011),i=t(99863),n=t(89417),a=t(79173),l=t(6346),c=e([s,i,n,a,l]);[s,i,n,a,l]=c.then?(await c)():c;let d=async(e,r)=>{if(!a.Z)return r.status(500).json({message:"Database not connected"});if(!(await (0,i.ed)("skins-collections")).enabled)return r.status(404).json({message:"Module not found"});await l.Z.run(e,r);let{method:t}=e,{collectionId:o}=e.query,c=await (0,s.U9)(Number(o));if(!c)return r.status(404).json({message:"Collection not found"});if("POST"===t){let t=await (0,n.Z)(e,r);if(!t)return;let i=c.likes,a=i.includes(t.id)?i.filter(e=>e!==t.id):[...i,t.id];return await (0,s.sl)(Number(o),a),r.status(200).json({likes:a})}};o()}catch(e){o(e)}})},6346:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.d(r,{Z:()=>d});var s=t(79649),i=t(45616),n=t(429),a=t.n(n),l=e([i]);i=(l.then?(await l)():l)[0];let c=(0,i.default)();c.use(a()({secret:process.env.SESSION_SECRET||"secret",maxAge:10368e6})),c.use(s.Z.initialize()),c.use(s.Z.session());let d=c;o()}catch(e){o(e)}})},79649:(e,r,t)=>{t.d(r,{Z:()=>a});var o=t(3511),s=t.n(o),i=t(53686);s().serializeUser(async(e,r)=>{r(null,e)}),s().deserializeUser(async(e,r)=>{r(null,e)});let n=process.env.DOMAIN||"";n.startsWith("http")||(n=`https://${n}`),s().use(new i.Strategy({returnURL:`${n}/api/auth/return`,realm:`${n}/`,apiKey:process.env.STEAM_API_KEY||""},(e,r,t)=>(r.identifier=e,t(null,r))));let a=s()},89417:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.d(r,{Z:()=>n});var s=t(79173),i=e([s]);s=(i.then?(await i)():i)[0];let n=(e,r)=>new Promise(async(t,o)=>s.Z?e.user?void t(e.user):o(r.status(400).json({success:!1,error:"Protected Route"})):r.status(500).json({message:"Database not connected"}));o()}catch(e){o(e)}})},17011:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.d(r,{Cz:()=>m,EH:()=>c,U9:()=>d,UQ:()=>h,YR:()=>p,dm:()=>w,fe:()=>u,sl:()=>E});var s=t(3929),i=t(97612),n=t(48057),a=t(78779),l=e([s,i,n,a]);[s,i,n,a]=l.then?(await l)():l;let c=async(e,r="CREATED")=>{if(!n.of)throw Error("No mysql connection");try{let t=(0,i.sql)`${a.Z.id} DESC`;switch(r){case"LIKES":t=(0,i.sql)`LENGTH(${a.Z.likes}) - LENGTH(REPLACE(${a.Z.likes}, ',', '')) DESC, ${a.Z.id} DESC`;break;case"CREATED":t=(0,i.sql)`${a.Z.id} DESC`}return(await n.of.select({id:a.Z.id,name:a.Z.name,steamid:a.Z.steamid,json:a.Z.json,likes:a.Z.likes,likes_count:(0,i.sql)`LENGTH(${a.Z.likes}) - LENGTH(REPLACE(${a.Z.likes}, ',', '')) as likes_count`,created_at:a.Z.created_at}).from(a.Z).where((0,i.eq)(s.wp_player_collections.steamid,e)).orderBy(t)).map(e=>({...e,json:JSON.parse(e.json),likes:JSON.parse(e.likes)}))}catch(e){return console.error(e),[]}},d=async e=>{if(!n.of)throw Error("No mysql connection");try{let r=await n.of.query.wp_player_collections.findFirst({where:(0,i.eq)(s.wp_player_collections.id,e)});if(!r)throw Error("Collection not found");return{...r,json:JSON.parse(r.json),likes:JSON.parse(r.likes)}}catch(e){throw console.error(`Error while getting collection by ID: ${e}`),Error("Collection not found")}},u=async e=>{if(!n.of)throw Error("No mysql connection");try{await n.of.delete(a.Z).where((0,i.eq)(s.wp_player_collections.id,e))}catch(e){throw console.error(`Error while deleting collection: ${e}`),Error("Failed to delete collection")}},p=async(e,r,t)=>{if(!n.of)throw Error("No mysql connection");try{await n.of.update(a.Z).set({json:JSON.stringify(t),name:r}).where((0,i.eq)(a.Z.id,e))}catch(e){throw console.error(`Error while updating collection: ${e}`),Error("Failed to update collection")}},E=async(e,r)=>{if(!n.of)throw Error("No mysql connection");try{await n.of.update(a.Z).set({likes:JSON.stringify(r)}).where((0,i.eq)(a.Z.id,e))}catch(e){throw console.error(`Error while updating collection likes: ${e}`),Error("Failed to update collection likes")}},m=async(e,r,t,o="CREATED")=>{if(!n.of)throw Error("No mysql connection");try{let s=t&&t.length>2?(0,i.or)((0,i.like)(a.Z.name,`%${t}%`),(0,i.like)(a.Z.steamid,`%${t}%`),(0,i.like)(a.Z.id,`%${t}%`)):void 0,l=(0,i.sql)`${a.Z.id} DESC`;switch(o){case"LIKES":l=(0,i.sql)`LENGTH(${a.Z.likes}) - LENGTH(REPLACE(${a.Z.likes}, ',', '')) DESC, ${a.Z.id} DESC`;break;case"CREATED":l=(0,i.sql)`${a.Z.id} DESC`}return(await n.of.select({id:a.Z.id,name:a.Z.name,steamid:a.Z.steamid,json:a.Z.json,likes:a.Z.likes,likes_count:(0,i.sql)`LENGTH(${a.Z.likes}) - LENGTH(REPLACE(${a.Z.likes}, ',', '')) as likes_count`,created_at:a.Z.created_at}).from(a.Z).where(s).orderBy(l).limit(r).offset((e-1)*r)).map(e=>({...e,json:JSON.parse(e.json),likes:JSON.parse(e.likes)}))}catch(e){return console.error(`[DB] Error while getting all skins collections: ${e}`),[]}},w=async e=>{if(!n.of)throw Error("No mysql connection");try{let r=e?(0,i.or)((0,i.like)(a.Z.steamid,`%${e}%`),(0,i.like)(a.Z.id,`%${e}%`)):void 0,[t]=await n.of.select({count:(0,i.sql)`COUNT(*)`}).from(a.Z).where(r);return t?.count??0}catch(e){return console.error(`[DB] Error while counting skins collections: ${e}`),0}},h=async(e,r,t)=>{if(!n.of)throw Error("No mysql connection");try{await n.of.insert(a.Z).values({steamid:e,name:r,json:JSON.stringify(t)})}catch(e){throw console.error(`Error while creating a new collection: ${e}`),Error("Failed to create a new collection")}};o()}catch(e){o(e)}})}};var r=require("../../../../../webpack-api-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[3337],()=>t(67411));module.exports=o})();