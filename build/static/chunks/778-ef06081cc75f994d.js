"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[778],{60778:(e,a,n)=>{n.d(a,{default:()=>J});var r=n(75819),s=n(57187),l=n(62989),i=n(38597),t=n(43838),o=n(51936),d=n(35182),c=n(80007),m=n(27114),u=n(75712),h=n(71095),x=n(56027),b=n(15085),j=n(35190),p=n(19219),v=n(59384),g=n(26935),f=n(93148),y=n(26499),w=n(27580),A=n(86114),N=n(70175),R=n(33004),_=n(71837);let T=(0,R.vt)(e=>({action:null,setAction:a=>e({action:a}),isLoading:!1,setIsLoading:a=>e({isLoading:a}),details:null,setDetails:a=>e({details:a}),reset:()=>e({action:null,isLoading:!1,details:null})}));_.z.object({reason:_.z.string()}),_.z.object({reason:_.z.string(),duration:_.z.string()}),_.z.object({comment:_.z.string()}),_.z.object({reason:_.z.string(),duration:_.z.string()}),_.z.enum(["unban","reban","comment","edit","delete"]);var C=n(93110),D=n(50580),P=n(73332),S=n(32243),z=n(1542),E=n(87031),I=n(4394),L=n(72626),k=n(95386),B=n(46777),M=n(88901),X=n(38245),U=n(88780),F=n(38512),V=n(59241);let O=_.z.object({player_steamid:_.z.string().optional(),player_ip:_.z.string().optional(),reason:_.z.string().min(3),duration:_.z.string(),comment:_.z.string().optional()}),Y=e=>{let{open:a,setOpen:n,mutate:s}=e,[l,i]=(0,x.useState)(!1),t=async()=>{if(!l){i(!0);try{await (0,V.A)("/api/bans",{method:"POST",data:o.values}),await s(),I.oR.success("Succesfully banned player!"),n(!1)}catch(n){var e;let a=(null==n?void 0:null===(e=n.response)||void 0===e?void 0:e.data)||(null==n?void 0:n.message);console.error(n),I.oR.error("Failed to create ban!\n".concat(a||n))}i(!1)}},o=(0,L.m)({initialValues:{player_steamid:"",player_ip:"",reason:"",duration:"",comment:""},validate:(0,k.u)(O)});return(0,r.jsx)(B.Y,{isOpen:a,onOpenChange:l?void 0:n,children:(0,r.jsx)(M.g,{children:e=>(0,r.jsxs)("form",{onSubmit:o.onSubmit(t),children:[(0,r.jsx)(X.c,{className:"flex flex-col gap-1",children:"Create new ban"}),(0,r.jsxs)(U.h,{children:[(0,r.jsx)("p",{children:"You can ban a player by either their Steam64 / SteamId / Profile URL or their IP address."}),(0,r.jsx)(w.r,{...o.getInputProps("player_steamid"),errorMessage:o.errors.player_steamid,isInvalid:!!o.errors.player_steamid,label:"Player Steam64 / SteamId / Profile URL",placeholder:"7656XXXXXX",variant:"bordered",isDisabled:l||!!o.values.player_ip,autoFocus:!0}),(0,r.jsx)(w.r,{...o.getInputProps("player_ip"),errorMessage:o.errors.player_ip,isInvalid:!!o.errors.player_ip,label:"IP Address",placeholder:"1.1.1.1",variant:"bordered",isDisabled:l||!!o.values.player_steamid}),(0,r.jsx)(w.r,{...o.getInputProps("reason"),errorMessage:o.errors.reason,isInvalid:!!o.errors.reason,label:"Reason (min 3 characters)",placeholder:"Cheating / Griefing / Toxicity / etc.",variant:"bordered",isDisabled:l}),(0,r.jsx)(w.r,{...o.getInputProps("duration"),errorMessage:o.errors.duration,isInvalid:!!o.errors.duration,label:"Duration in minutes",placeholder:"for example, 60",description:"0 for permanent",variant:"bordered",type:"number",isDisabled:l}),(0,r.jsx)(w.r,{...o.getInputProps("comment"),errorMessage:o.errors.comment,isInvalid:!!o.errors.comment,label:"Comment (optional)",variant:"bordered",isDisabled:l}),(0,r.jsxs)("div",{className:"flex flex-col text-xs",children:[(0,r.jsxs)("span",{children:["The ban will start now ",(0,r.jsxs)("b",{children:["(",(0,C.A)(),")"]})]}),(0,r.jsxs)("span",{children:["and will end at"," ",(0,r.jsx)("b",{children:"0"===o.values.duration?(0,r.jsx)("b",{className:"text-red-700",children:"Permanent"}):(0,C.A)(new Date().getTime()+6e4*Number(o.values.duration))})]})]})]}),(0,r.jsxs)(F.q,{children:[(0,r.jsx)(f.T,{color:"danger",variant:"flat",onPress:e,isDisabled:l,children:"Cancel"}),(0,r.jsx)(f.T,{color:"primary",type:"submit",isLoading:l,children:"Ban player"})]})]})})})},G=e=>{switch(e){case"ACTIVE":return(0,r.jsx)(A.R,{color:"danger",size:"sm",variant:"flat",radius:"sm",children:"Active"});case"EXPIRED":return(0,r.jsx)(A.R,{color:"success",size:"sm",variant:"flat",radius:"sm",children:"Expired"});case"UNBANNED":return(0,r.jsx)(A.R,{color:"secondary",size:"sm",variant:"flat",radius:"sm",children:"Removed"});default:return(0,r.jsx)(A.R,{color:"secondary",size:"sm",variant:"flat",radius:"sm",children:"Unknown"})}};var W=n(14738),q=n.n(W),H=n(4452);let J=e=>{var a,n;let{type:R}=e,[_,L]=(0,x.useState)(!1),[k,B]=(0,x.useState)(1),[M,X]=(0,x.useState)(""),[U]=(0,y.d7)(M,500),F=10;"/"===(0,g.usePathname)()&&(F=5);let{data:O,isLoading:W,mutate:J}=(0,H.Ay)("/api/bans?page=".concat(k,"&rows=").concat(F,"&query=").concat(U),E.A,{keepPreviousData:!0}),K=(0,x.useMemo)(()=>(null==O?void 0:O.count)?Math.ceil(O.count/F):0,[null==O?void 0:O.count,F]),{admin:Q}=(0,z.Ay)(),{x:Z,y:$,open:ee,handleCloseMenu:ea,handleOpen:en,info:er}=(0,P.A)(),es=T(e=>e.action),el=T(e=>e.setAction),ei=T(e=>e.details),et=T(e=>e.setDetails),eo=T(e=>e.isLoading),ed=T(e=>e.setIsLoading),ec=T(e=>e.reset),em=async()=>{if(es&&!eo&&er){ed(!0);try{await V.A.post("/api/bans/".concat(er.id),{action:es,details:ei}),await J(),ec(),I.Ay.success("Player ".concat(es,"ed successfully"))}catch(e){I.Ay.error("Error ".concat(es," player"))}ed(!1)}},eu=(e,a)=>{var n,s,l,i;switch(a){case"player_name":return(0,r.jsx)(q(),{href:"https://steamcommunity.com/profiles/".concat(e.player_steamid),target:"_blank",passHref:!0,children:(0,r.jsx)(N.S,{avatarProps:{radius:"lg",src:e.player_avatar||""},name:e.player_name,children:null===(n=e.player_name)||void 0===n?void 0:n.slice(0,10)})});case"status":return G(e.status);case"reason":return e.reason.length>10?(0,r.jsx)(v.I,{content:e.reason,"aria-label":"Reason",showArrow:!0,children:(0,r.jsx)("div",{className:"text-xs font-light",children:e.reason.slice(0,10)})}):(0,r.jsx)("div",{className:"text-xs font-light",children:e.reason});case"unban_reason":return e.unban_reason&&e.unban_reason.length>10?(0,r.jsx)(v.I,{content:e.unban_reason,"aria-label":"Remove Reason",showArrow:!0,children:(0,r.jsx)("div",{className:"text-xs font-light",children:null===(s=e.unban_reason)||void 0===s?void 0:s.slice(0,10)})}):(0,r.jsx)("div",{className:"text-xs font-light",children:e.unban_reason});case"duration":return(0,r.jsx)(A.R,{color:"primary",size:"sm",variant:"flat",radius:"sm",children:0===e.duration?"Permanent":"".concat(e.duration," minutes")});case"admin_name":return e.admin_name?"Console"===e.admin_name?(0,r.jsx)(A.R,{color:"danger",size:"sm",variant:"flat",radius:"sm",children:"Console"}):(0,r.jsx)(q(),{href:"https://steamcommunity.com/profiles/".concat(e.admin_steamid),target:"_blank",passHref:!0,children:(0,r.jsx)(N.S,{avatarProps:{radius:"lg",src:e.admin_avatar||""},name:e.admin_name,children:e.admin_name})}):(0,r.jsx)(r.Fragment,{children:"-"});case"timeLeft":if(0===e.duration)return(0,r.jsx)(A.R,{color:"danger",size:"sm",variant:"flat",radius:"sm",children:"Permanent"});if("UNBANNED"===e.status||"EXPIRED"===e.status)return(0,r.jsx)(j.o,{color:"success",value:100,"aria-label":"Expired"});let t=new Date,o=new Date(e.created),d=new Date(e.ends),c=Math.round((t.getTime()-o.getTime())/(d.getTime()-o.getTime())*100),m=Math.round((d.getTime()-t.getTime())/6e4),u=c<50?"warning":c>=100?"success":"primary";return m>0?(0,r.jsx)(v.I,{content:"".concat(m," minutes left"),color:u,"aria-label":"Time left",showArrow:!0,children:(0,r.jsx)(j.o,{color:u,value:c,"aria-label":"".concat(m," minutes left")})}):(0,r.jsx)(j.o,{color:u,value:c,"aria-label":"Expired"});case"comment":return e.comment?e.comment.length>10?(0,r.jsx)(v.I,{content:e.comment,"aria-label":"Comment",showArrow:!0,children:(0,r.jsx)("div",{className:"text-xs font-light",children:null===(l=e.comment)||void 0===l?void 0:l.slice(0,10)})}):(0,r.jsx)("div",{className:"text-xs font-light",children:null===(i=e.comment)||void 0===i?void 0:i.slice(0,10)}):(0,r.jsx)(r.Fragment,{children:"-"});case"created":return(0,C.A)(e.created);default:return(0,r.jsx)(r.Fragment,{})}},eh=(0,r.jsx)(r.Fragment,{});switch(R){case"MANAGE":eh=(0,r.jsxs)(s.X,{children:[(0,r.jsx)(l.e,{"aria-label":"Player",children:"Player"},"player_name"),(0,r.jsx)(l.e,{"aria-label":"Status",children:"Status"},"status"),(0,r.jsx)(l.e,{"aria-label":"Admin",children:"Admin"},"admin_name"),(0,r.jsx)(l.e,{"aria-label":"Reason",children:"Reason"},"reason"),(0,r.jsx)(l.e,{"aria-label":"Remove Reason",children:"Remove Reason"},"unban_reason"),(0,r.jsx)(l.e,{"aria-label":"Date/Time",children:"Date/Time"},"created"),(0,r.jsx)(l.e,{"aria-label":"Duration",children:"Duration"},"duration"),(0,r.jsx)(l.e,{"aria-label":"Time left",children:"Time left"},"timeLeft"),(0,r.jsx)(l.e,{"aria-label":"Comment",children:"Comment"},"comment")]});break;case"SMALL":eh=(0,r.jsxs)(s.X,{children:[(0,r.jsx)(l.e,{"aria-label":"Player",children:"Player"},"player_name"),(0,r.jsx)(l.e,{"aria-label":"Status",children:"Status"},"status"),(0,r.jsx)(l.e,{"aria-label":"Reason",children:"Reason"},"reason"),(0,r.jsx)(l.e,{"aria-label":"Duration",children:"Duration"},"duration"),(0,r.jsx)(l.e,{"aria-label":"Time left",children:"Time left"},"timeLeft")]});break;case"NORMAL":eh=(0,r.jsxs)(s.X,{children:[(0,r.jsx)(l.e,{"aria-label":"Player",children:"Player"},"player_name"),(0,r.jsx)(l.e,{"aria-label":"Status",children:"Status"},"status"),(0,r.jsx)(l.e,{"aria-label":"Admin",children:"Admin"},"admin_name"),(0,r.jsx)(l.e,{"aria-label":"Reason",children:"Reason"},"reason"),(0,r.jsx)(l.e,{"aria-label":"Remove Reason",children:"Remove Reason"},"unban_reason"),(0,r.jsx)(l.e,{"aria-label":"Date/Time",children:"Date/Time"},"created"),(0,r.jsx)(l.e,{"aria-label":"Duration",children:"Duration"},"duration"),(0,r.jsx)(l.e,{"aria-label":"Time left",children:"Time left"},"timeLeft")]})}let ex=["@web/root","@css/root","@web/bans"],eb=(null==Q?void 0:null===(a=Q.flags)||void 0===a?void 0:a.some(e=>ex.includes(e)))||!1;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(i.j,{topContent:(0,r.jsxs)("div",{className:"flex flex-row justify-between",children:[(0,r.jsxs)("div",{className:"text-start",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Bans"}),(0,r.jsxs)("code",{className:"text-sm font-normal",children:["total: ",(null==O?void 0:O.count)||""]})]}),(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)(v.I,{content:"Search for player name, steamid, IP, reason, etc.",closeDelay:50,color:"primary",delay:400,"aria-label":"Search",children:(0,r.jsx)(w.r,{label:"Search",labelPlacement:"outside-left",value:M,onValueChange:X,size:"sm",classNames:{mainWrapper:"h-fit",base:"h-fit"},"aria-label":"Search",isClearable:!0})}),Q&&eb&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(f.T,{size:"sm",variant:"flat",color:"primary",onClick:()=>L(!0),"aria-label":"New ban",children:[(0,r.jsx)(c.A,{size:46,"aria-label":"New ban"}),"New ban"]}),(0,r.jsx)(Y,{open:_,setOpen:L,mutate:J})]})]})]}),bottomContent:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex w-full justify-center",children:(0,r.jsx)(b.T,{color:"primary",page:k,total:K,onChange:e=>B(e),"aria-label":"Pagination",size:"sm",isCompact:!0,showControls:!0,showShadow:!0})}),Q&&"MANAGE"===R&&(0,r.jsx)("span",{className:"text-sm",children:"Tip, your can right click on a player row for more actions"})]}),children:[eh,(0,r.jsx)(t.E,{items:null!==(n=null==O?void 0:O.results)&&void 0!==n?n:[],loadingContent:(0,r.jsx)(p.o,{"aria-label":"Loading"}),loadingState:W?"loading":"idle",children:e=>(0,r.jsx)(o.s,{onContextMenu:a=>Q&&en&&en(a,e)||void 0,"aria-label":e.player_name||"",children:a=>(0,r.jsx)(d.w,{"aria-label":a.toString(),children:eu(e,a)})},e.id)})]}),Q&&(0,r.jsx)(S.A,{open:ee,x:Z,y:$,handleCloseMenu:ea,items:[{category:"Ban Actions",items:[{key:"Comment",description:"Write a comment on this ban, this will be visible to other admins",icon:m.A,color:"default",onClick:()=>{el("comment"),et({comment:(null==er?void 0:er.comment)||""})},flags:["@css/root","@web/bans","@web/root"]},{key:(null==er?void 0:er.status)==="UNBANNED"||(null==er?void 0:er.status)==="EXPIRED"?"Reban":"Remove Ban (shorten)",description:(null==er?void 0:er.status)==="UNBANNED"||(null==er?void 0:er.status)==="EXPIRED"?"Reban the player":"Remove the player ban (shorten the duration)",icon:u.A,color:"default",onClick:()=>{(null==er?void 0:er.status)==="UNBANNED"||(null==er?void 0:er.status)==="EXPIRED"?(el("reban"),et({reason:"",duration:"0"})):(el("unban"),et({reason:""}))},flags:["@css/root","@web/bans","@web/root"]},{key:"Edit Ban",description:"Edit the ban duration or reason",icon:m.A,color:"primary",onClick:()=>{var e;el("edit"),et({reason:(null==er?void 0:er.reason)||"",duration:(null==er?void 0:null===(e=er.duration)||void 0===e?void 0:e.toString())||"0"})},flags:["@css/root","@web/bans","@web/root"]},{key:"Delete Ban",description:"Delete the ban from the database (permanent action)",icon:h.A,color:"danger",onClick:()=>{el("delete")},flags:["@css/root","@web/bans","@web/root"]}]}]}),Q&&(0,r.jsxs)(D.A,{open:"comment"===es,handleClose:ec,action:em,isLoading:eo,actionText:"Save",children:[(0,r.jsx)("div",{children:"Write a comment on this ban, this will be visible to other admins"}),(0,r.jsx)(w.r,{label:"Comment",value:(null==ei?void 0:ei.comment)||"",onValueChange:e=>et({comment:e}),"aria-label":"Comment"})]}),Q&&(0,r.jsxs)(D.A,{open:"unban"===es,handleClose:ec,action:em,isLoading:eo,actionText:"Unban",children:[(0,r.jsx)("div",{children:"You sure you want to unban the user?"}),(0,r.jsx)(w.r,{label:"Reason",value:(null==ei?void 0:ei.reason)||"",onValueChange:e=>et({reason:e}),"aria-label":"Unban Reason"})]}),Q&&(0,r.jsxs)(D.A,{open:"reban"===es,handleClose:ec,action:em,isLoading:eo,actionText:"Reban",children:[(0,r.jsx)("div",{children:"You sure you want to reban the user?"}),(0,r.jsx)(w.r,{label:"Reason",value:(null==ei?void 0:ei.reason)||"",onValueChange:e=>et({...ei,reason:e}),"aria-label":"Ban Reason"}),(0,r.jsx)(w.r,{label:"Time (in minutes)",type:"number",value:(null==ei?void 0:ei.duration)||"",onValueChange:e=>et({...ei,duration:e}),description:"Time in minutes, 0 = Permanent ban","aria-label":"Ban Time"}),(0,r.jsxs)("div",{className:"flex flex-col text-xs",children:[(0,r.jsxs)("span",{children:["The ban will start again at ",(0,r.jsx)("b",{children:(0,C.A)()})]}),(0,r.jsxs)("span",{children:["the ban will end at"," ",(0,r.jsx)("b",{children:(null==ei?void 0:ei.duration)==="0"?(0,r.jsx)("b",{className:"text-red-700",children:"Permanent"}):(0,C.A)(new Date().getTime()+6e4*Number(null==ei?void 0:ei.duration))})]})]})]}),Q&&(0,r.jsxs)(D.A,{open:"edit"===es,handleClose:ec,action:em,isLoading:eo,actionText:"Edit",children:[(0,r.jsx)("div",{children:"This will replace the ban duration or reason"}),(0,r.jsx)(w.r,{label:"Ban Reason",value:(null==ei?void 0:ei.reason)||"",onValueChange:e=>et({...ei,reason:e}),"aria-label":"Ban Reason"}),(0,r.jsx)(w.r,{label:"Ban Time (in minutes)",type:"number",value:(null==ei?void 0:ei.duration)||"",onValueChange:e=>et({...ei,duration:e}),description:"Time in minutes, this will be added to the current duration, 0 = Permanent ban (will replace the duration)","aria-label":"Ban Time"}),(0,r.jsxs)("div",{className:"flex flex-col text-xs",children:[(0,r.jsxs)("span",{children:["The ban started at ",(0,r.jsx)("b",{children:(0,C.A)(null==er?void 0:er.created)})]}),(0,r.jsxs)("span",{children:["After the edit, the ban will end at"," ",(0,r.jsx)("b",{children:(null==ei?void 0:ei.duration)==="0"?(0,r.jsx)("b",{className:"text-red-700",children:"Permanent"}):(0,C.A)(new Date((null==er?void 0:er.created)||"").getTime()+6e4*Number(null==ei?void 0:ei.duration))})]})]})]}),Q&&(0,r.jsx)(D.A,{open:"delete"===es,handleClose:ec,action:em,isLoading:eo,actionText:"Delete",children:(0,r.jsx)("div",{children:"Are you sure you want to delete the ban? this action is permanent and cannot be undone"})})]})}}}]);