"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1698],{81698:function(e,t,n){n.r(t);var a=n(57437),r=n(28857),o=n(653),i=n(2265),l=n(22628),s=n(28866),c=n.n(s),d=n(40257);let u=(0,i.forwardRef)((e,t)=>{let{url:n,x:o,y:i,rotation:l,onDragEnd:s,onTransformEnd:d,onClick:u,scale:h}=e,[x]=c()(n);return(0,a.jsx)(r.Ee,{image:x,x:o,y:i,rotation:l,onDragEnd:s,onTransformEnd:d,onClick:u,ref:t,width:h.width,height:h.height,shadowColor:"black",shadowOpacity:.8,shadowBlur:10,shadowEnabled:!0,draggable:!0})}),h=e=>{let{weaponType:t,weaponUrl:n,stickers:s,setStickers:h,chooseSticker:x,setChooseSticker:f}=e,[y]=c()(n),[g,m]=(0,i.useState)("");console.log({weapon:y,weaponUrl:n});let v=(e,n,a)=>{let r=5===a,i=o.se[t],l=r?i.keychain.position:i.basePosition,s=r?i.keychain.movementScale:i.movementScale,c=e-l.x,d=n-l.y;return[c*s.x/650,d*s.y/200]},w=(e,n,a)=>{let r=5===a,i=o.se[t],l=r?i.keychain.position:i.basePosition,s=r?i.keychain.movementScale:i.movementScale;return[650*e/s.x+l.x,200*n/s.y+l.y]},k=(e,t)=>{let[n,a]=v(e.target.x(),e.target.y(),t);f(t);let r=[...s];r[t]={...r[t],rotation:e.target.rotation(),x:n,y:a},h(r),m("UI: (".concat(e.target.x().toFixed(2),", ").concat(e.target.y().toFixed(2),") Game: (").concat(n.toFixed(4),", ").concat(a.toFixed(4),")"))},E=(0,i.useRef)(null),b=(0,i.useRef)([]),p=e=>{var t;let n=null===(t=E.current)||void 0===t?void 0:t.nodes()[0];if(f(e),n){let t=[...s];"rotation"in t[e]&&(t[e].rotation=n.rotation()),h(t)}};(0,i.useEffect)(()=>{var e,t,n,a;E.current&&b.current[x]?(E.current.nodes([b.current[x]]),null===(e=E.current.getLayer())||void 0===e||e.batchDraw()):(null===(t=E.current)||void 0===t||t.nodes([]),null===(a=E.current)||void 0===a||null===(n=a.getLayer())||void 0===n||n.batchDraw())},[x,s]);let j=5===x;return(0,a.jsx)(r.Hf,{width:650,height:200,style:{margin:"0 auto",zIndex:1e3,position:"relative"},className:"flex justify-center",children:(0,a.jsxs)(r.mh,{children:[(0,a.jsx)(r.Ee,{image:y,x:0,y:0,width:650,height:400,offsetY:100}),s.map((e,n)=>{var r;let[i,s]=w(e.x,e.y,n),c=5===n,d=(c?l.RZ:o.HG).find(t=>t.id===e.id.toString());if(!d)return null;let h=d.image||"",x=o.se[t],y=c?x.keychain.scale:x.scale;return(0,a.jsx)(u,{url:h,x:i,y:s,rotation:"rotation"in e&&null!==(r=e.rotation)&&void 0!==r?r:0,onDragEnd:e=>k(e,n),onClick:()=>f(n),onTransformEnd:()=>p(n),ref:e=>{e&&(b.current[n]=e)},scale:y},n)}),(0,a.jsx)(r.$T,{ref:E,rotateEnabled:!j,resizeEnabled:!1,rotateAnchorOffset:20}),"http://localhost:3000"===d.env.DOMAIN&&(0,a.jsx)(r.xv,{text:g,x:10,y:10,fill:"white"})]})})};u.displayName="Sticker",h.displayName="Canvas",t.default=h}}]);