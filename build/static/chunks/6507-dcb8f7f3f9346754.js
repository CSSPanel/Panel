"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6507],{86507:function(e,n,a){a.d(n,{default:function(){return J}});var s=a(94773),t=a(20566),r=a(87880),i=a(51089),l=a(77730),o=a(49405),d=a(17279),c=a(64349),u=a(91185),m=a(92300),h=a(85330),x=a(44208),j=a(39206),b=a(53751),p=a(73607),v=a(66596),g=a(42778),f=a(39596),y=a(68179),w=a(90885),N=a(89405),_=a(88341),C=a(45478),P=a(68668);let z=(0,C.Ue)(e=>({action:null,setAction:n=>e({action:n}),isLoading:!1,setIsLoading:n=>e({isLoading:n}),details:null,setDetails:n=>e({details:n}),reset:()=>e({action:null,isLoading:!1,details:null})}));P.z.object({reason:P.z.string()}),P.z.object({reason:P.z.string(),duration:P.z.string()}),P.z.object({comment:P.z.string()}),P.z.object({reason:P.z.string(),duration:P.z.string()}),P.z.enum(["unban","reban","comment","edit","delete"]);var D=a(13772),A=a(31467),T=a(79511),R=a(93203),Z=a(46736),E=a(83455),S=a(96509),I=a(66060),k=a(47216),L=a(15105),M=a(23151),Y=a(39720),B=a(35504),X=a(44098),F=a(24909);let U=P.z.object({player_steamid:P.z.string().optional(),player_ip:P.z.string().optional(),reason:P.z.string().min(3),duration:P.z.string(),comment:P.z.string().optional()});var V=e=>{let{open:n,setOpen:a,mutate:t}=e,[r,i]=(0,x.useState)(!1),l=async()=>{if(!r){i(!0);try{await (0,F.Z)("/api/bans",{method:"POST",data:o.values}),await t(),S.Am.success("Succesfully banned player!"),a(!1)}catch(a){var e;let n=(null==a?void 0:null===(e=a.response)||void 0===e?void 0:e.data)||(null==a?void 0:a.message);console.error(a),S.Am.error("Failed to create ban!\n".concat(n||a))}i(!1)}},o=(0,I.c)({initialValues:{player_steamid:"",player_ip:"",reason:"",duration:"",comment:""},validate:(0,k.F)(U)});return(0,s.jsx)(L.R,{isOpen:n,onOpenChange:r?void 0:a,children:(0,s.jsx)(M.A,{children:e=>(0,s.jsxs)("form",{onSubmit:o.onSubmit(l),children:[(0,s.jsx)(Y.k,{className:"flex flex-col gap-1",children:"Create new ban"}),(0,s.jsxs)(B.I,{children:[(0,s.jsx)("p",{children:"You can ban a player by either their Steam64 / SteamId / Profile URL or their IP address."}),(0,s.jsx)(w.Y,{...o.getInputProps("player_steamid"),errorMessage:o.errors.player_steamid,isInvalid:!!o.errors.player_steamid,label:"Player Steam64 / SteamId / Profile URL",placeholder:"7656XXXXXX",variant:"bordered",isDisabled:r||!!o.values.player_ip,autoFocus:!0}),(0,s.jsx)(w.Y,{...o.getInputProps("player_ip"),errorMessage:o.errors.player_ip,isInvalid:!!o.errors.player_ip,label:"IP Address",placeholder:"1.1.1.1",variant:"bordered",isDisabled:r||!!o.values.player_steamid}),(0,s.jsx)(w.Y,{...o.getInputProps("reason"),errorMessage:o.errors.reason,isInvalid:!!o.errors.reason,label:"Reason (min 3 characters)",placeholder:"Cheating / Griefing / Toxicity / etc.",variant:"bordered",isDisabled:r}),(0,s.jsx)(w.Y,{...o.getInputProps("duration"),errorMessage:o.errors.duration,isInvalid:!!o.errors.duration,label:"Duration in minutes",placeholder:"for example, 60",description:"0 for permanent",variant:"bordered",type:"number",isDisabled:r}),(0,s.jsx)(w.Y,{...o.getInputProps("comment"),errorMessage:o.errors.comment,isInvalid:!!o.errors.comment,label:"Comment (optional)",variant:"bordered",isDisabled:r}),(0,s.jsxs)("div",{className:"flex flex-col text-xs",children:[(0,s.jsxs)("span",{children:["The ban will start now ",(0,s.jsxs)("b",{children:["(",(0,D.Z)(),")"]})]}),(0,s.jsxs)("span",{children:["and will end at"," ",(0,s.jsx)("b",{children:"0"===o.values.duration?(0,s.jsx)("b",{className:"text-red-700",children:"Permanent"}):(0,D.Z)(new Date().getTime()+6e4*Number(o.values.duration))})]})]})]}),(0,s.jsxs)(X.R,{children:[(0,s.jsx)(f.A,{color:"danger",variant:"flat",onPress:e,isDisabled:r,children:"Cancel"}),(0,s.jsx)(f.A,{color:"primary",type:"submit",isLoading:r,children:"Ban player"})]})]})})})},W=e=>{switch(e){case"ACTIVE":return(0,s.jsx)(N.z,{color:"danger",size:"sm",variant:"flat",radius:"sm",children:"Active"});case"EXPIRED":return(0,s.jsx)(N.z,{color:"success",size:"sm",variant:"flat",radius:"sm",children:"Expired"});case"UNBANNED":return(0,s.jsx)(N.z,{color:"secondary",size:"sm",variant:"flat",radius:"sm",children:"Removed"});default:return(0,s.jsx)(N.z,{color:"secondary",size:"sm",variant:"flat",radius:"sm",children:"Unknown"})}},O=a(57970),G=a(17054),J=e=>{var n,a;let{type:C}=e,[P,I]=(0,x.useState)(!1),[k,L]=(0,x.useState)(1),[M,Y]=(0,x.useState)(""),[B]=(0,y.Nr)(M,500),X=10;"/"===(0,g.usePathname)()&&(X=5);let{data:U,isLoading:J,mutate:H}=(0,G.ZP)("/api/bans?page=".concat(k,"&rows=").concat(X,"&query=").concat(B),E.Z,{keepPreviousData:!0}),q=(0,x.useMemo)(()=>(null==U?void 0:U.count)?Math.ceil(U.count/X):0,[null==U?void 0:U.count,X]),{admin:K}=(0,Z.ZP)(),{x:Q,y:$,open:ee,handleCloseMenu:en,handleOpen:ea,info:es}=(0,T.Z)(),et=z(e=>e.action),er=z(e=>e.setAction),ei=z(e=>e.details),el=z(e=>e.setDetails),eo=z(e=>e.isLoading),ed=z(e=>e.setIsLoading),ec=z(e=>e.reset),eu=async()=>{if(et&&!eo&&es){ed(!0);try{await F.Z.post("/api/bans/".concat(es.id),{action:et,details:ei}),await H(),ec(),S.ZP.success("Player ".concat(et,"ed successfully"))}catch(e){S.ZP.error("Error ".concat(et," player"))}ed(!1)}},em=(e,n)=>{var a,t,r,i;switch(n){case"player_name":return(0,s.jsx)(O.default,{href:"https://steamcommunity.com/profiles/".concat(e.player_steamid),target:"_blank",passHref:!0,children:(0,s.jsx)(_.z,{avatarProps:{radius:"lg",src:e.player_avatar||""},name:e.player_name,children:null===(a=e.player_name)||void 0===a?void 0:a.slice(0,10)})});case"status":return W(e.status);case"reason":return e.reason.length>10?(0,s.jsx)(v.e,{content:e.reason,showArrow:!0,children:(0,s.jsx)("div",{className:"text-xs font-light",children:e.reason.slice(0,10)})}):(0,s.jsx)("div",{className:"text-xs font-light",children:e.reason});case"unban_reason":return e.unban_reason&&e.unban_reason.length>10?(0,s.jsx)(v.e,{content:e.unban_reason,showArrow:!0,children:(0,s.jsx)("div",{className:"text-xs font-light",children:null===(t=e.unban_reason)||void 0===t?void 0:t.slice(0,10)})}):(0,s.jsx)("div",{className:"text-xs font-light",children:e.unban_reason});case"duration":return(0,s.jsx)(N.z,{color:"primary",size:"sm",variant:"flat",radius:"sm",children:0===e.duration?"Permanent":"".concat(e.duration," minutes")});case"admin_name":return e.admin_name?"Console"===e.admin_name?(0,s.jsx)(N.z,{color:"danger",size:"sm",variant:"flat",radius:"sm",children:"Console"}):(0,s.jsx)(O.default,{href:"https://steamcommunity.com/profiles/".concat(e.admin_steamid),target:"_blank",passHref:!0,children:(0,s.jsx)(_.z,{avatarProps:{radius:"lg",src:e.admin_avatar||""},name:e.admin_name,children:e.admin_name})}):(0,s.jsx)(s.Fragment,{children:"-"});case"timeLeft":if(0===e.duration)return(0,s.jsx)(N.z,{color:"danger",size:"sm",variant:"flat",radius:"sm",children:"Permanent"});if("UNBANNED"===e.status||"EXPIRED"===e.status)return(0,s.jsx)(b.W,{color:"success",value:100,isStriped:!0});let l=new Date,o=new Date(e.created),d=new Date(e.ends),c=Math.round((l.getTime()-o.getTime())/(d.getTime()-o.getTime())*100),u=Math.round((d.getTime()-l.getTime())/6e4),m=c<50?"warning":c>=100?"success":"primary";return u>0?(0,s.jsx)(v.e,{content:"".concat(u," minutes left"),color:m,showArrow:!0,children:(0,s.jsx)(b.W,{color:m,value:c,isStriped:!0})}):(0,s.jsx)(b.W,{color:m,value:c,isStriped:!0});case"comment":return e.comment?e.comment.length>10?(0,s.jsx)(v.e,{content:e.comment,showArrow:!0,children:(0,s.jsx)("div",{className:"text-xs font-light",children:null===(r=e.comment)||void 0===r?void 0:r.slice(0,10)})}):(0,s.jsx)("div",{className:"text-xs font-light",children:null===(i=e.comment)||void 0===i?void 0:i.slice(0,10)}):(0,s.jsx)(s.Fragment,{children:"-"});case"created":return(0,D.Z)(e.created);default:return(0,s.jsx)(s.Fragment,{})}},eh=(0,s.jsx)(s.Fragment,{});switch(C){case"MANAGE":eh=(0,s.jsxs)(t.J,{children:[(0,s.jsx)(r.j,{children:"Player"},"player_name"),(0,s.jsx)(r.j,{children:"Status"},"status"),(0,s.jsx)(r.j,{children:"Admin"},"admin_name"),(0,s.jsx)(r.j,{children:"Reason"},"reason"),(0,s.jsx)(r.j,{children:"Remove Reason"},"unban_reason"),(0,s.jsx)(r.j,{children:"Date/Time"},"created"),(0,s.jsx)(r.j,{children:"Duration"},"duration"),(0,s.jsx)(r.j,{children:"Time left"},"timeLeft"),(0,s.jsx)(r.j,{children:"Comment"},"comment")]});break;case"SMALL":eh=(0,s.jsxs)(t.J,{children:[(0,s.jsx)(r.j,{children:"Player"},"player_name"),(0,s.jsx)(r.j,{children:"Status"},"status"),(0,s.jsx)(r.j,{children:"Reason"},"reason"),(0,s.jsx)(r.j,{children:"Duration"},"duration"),(0,s.jsx)(r.j,{children:"Time left"},"timeLeft")]});break;case"NORMAL":eh=(0,s.jsxs)(t.J,{children:[(0,s.jsx)(r.j,{children:"Player"},"player_name"),(0,s.jsx)(r.j,{children:"Status"},"status"),(0,s.jsx)(r.j,{children:"Admin"},"admin_name"),(0,s.jsx)(r.j,{children:"Reason"},"reason"),(0,s.jsx)(r.j,{children:"Remove Reason"},"unban_reason"),(0,s.jsx)(r.j,{children:"Date/Time"},"created"),(0,s.jsx)(r.j,{children:"Duration"},"duration"),(0,s.jsx)(r.j,{children:"Time left"},"timeLeft")]})}let ex=["@web/root","@css/root","@web/bans"],ej=(null==K?void 0:null===(n=K.flags)||void 0===n?void 0:n.some(e=>ex.includes(e)))||!1;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(i.b,{topContent:(0,s.jsxs)("div",{className:"flex flex-row justify-between",children:[(0,s.jsxs)("div",{className:"text-start",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"Bans"}),(0,s.jsxs)("code",{className:"text-sm font-normal",children:["total: ",(null==U?void 0:U.count)||""]})]}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)(v.e,{content:"Search for player name, steamid, IP, reason, etc.",closeDelay:50,color:"primary",delay:400,children:(0,s.jsx)(w.Y,{label:"Search",labelPlacement:"outside-left",value:M,onValueChange:Y,size:"sm",classNames:{mainWrapper:"h-fit",base:"h-fit"},isClearable:!0})}),K&&ej&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(f.A,{size:"sm",variant:"flat",color:"primary",onClick:()=>I(!0),children:[(0,s.jsx)(c.Z,{size:46}),"New ban"]}),(0,s.jsx)(V,{open:P,setOpen:I,mutate:H})]})]})]}),bottomContent:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"flex w-full justify-center",children:(0,s.jsx)(j.g,{color:"primary",page:k,total:q,onChange:e=>L(e),size:"sm",isCompact:!0,showControls:!0,showShadow:!0})}),K&&"MANAGE"===C&&(0,s.jsx)("span",{className:"text-sm",children:"Tip, your can right click on a player row for more actions"})]}),children:[eh,(0,s.jsx)(l.y,{items:null!==(a=null==U?void 0:U.results)&&void 0!==a?a:[],loadingContent:(0,s.jsx)(p.c,{}),loadingState:J?"loading":"idle",children:e=>(0,s.jsx)(o.g,{onContextMenu:n=>K&&ea&&ea(n,e)||void 0,children:n=>(0,s.jsx)(d.X,{children:em(e,n)})},e.id)})]}),K&&(0,s.jsx)(R.Z,{open:ee,x:Q,y:$,handleCloseMenu:en,items:[{category:"Ban Actions",items:[{key:"Comment",description:"Write a comment on this ban, this will be visible to other admins",icon:u.Z,color:"default",onClick:()=>{er("comment"),el({comment:(null==es?void 0:es.comment)||""})},flags:["@css/root","@web/bans","@web/root"]},{key:(null==es?void 0:es.status)==="UNBANNED"||(null==es?void 0:es.status)==="EXPIRED"?"Reban":"Remove Ban (shorten)",description:(null==es?void 0:es.status)==="UNBANNED"||(null==es?void 0:es.status)==="EXPIRED"?"Reban the player":"Remove the player ban (shorten the duration)",icon:m.Z,color:"default",onClick:()=>{(null==es?void 0:es.status)==="UNBANNED"||(null==es?void 0:es.status)==="EXPIRED"?(er("reban"),el({reason:"",duration:"0"})):(er("unban"),el({reason:""}))},flags:["@css/root","@web/bans","@web/root"]},{key:"Edit Ban",description:"Edit the ban duration or reason",icon:u.Z,color:"primary",onClick:()=>{var e;er("edit"),el({reason:(null==es?void 0:es.reason)||"",duration:(null==es?void 0:null===(e=es.duration)||void 0===e?void 0:e.toString())||"0"})},flags:["@css/root","@web/bans","@web/root"]},{key:"Delete Ban",description:"Delete the ban from the database (permanent action)",icon:h.Z,color:"danger",onClick:()=>{er("delete")},flags:["@css/root","@web/bans","@web/root"]}]}]}),K&&(0,s.jsxs)(A.Z,{open:"comment"===et,handleClose:ec,action:eu,isLoading:eo,actionText:"Save",children:[(0,s.jsx)("div",{children:"Write a comment on this ban, this will be visible to other admins"}),(0,s.jsx)(w.Y,{label:"Comment",value:(null==ei?void 0:ei.comment)||"",onValueChange:e=>el({comment:e})})]}),K&&(0,s.jsxs)(A.Z,{open:"unban"===et,handleClose:ec,action:eu,isLoading:eo,actionText:"Unban",children:[(0,s.jsx)("div",{children:"You sure you want to unban the user?"}),(0,s.jsx)(w.Y,{label:"Reason",value:(null==ei?void 0:ei.reason)||"",onValueChange:e=>el({reason:e})})]}),K&&(0,s.jsxs)(A.Z,{open:"reban"===et,handleClose:ec,action:eu,isLoading:eo,actionText:"Reban",children:[(0,s.jsx)("div",{children:"You sure you want to reban the user?"}),(0,s.jsx)(w.Y,{label:"Reason",value:(null==ei?void 0:ei.reason)||"",onValueChange:e=>el({...ei,reason:e})}),(0,s.jsx)(w.Y,{label:"Time (in minutes)",type:"number",value:(null==ei?void 0:ei.duration)||"",onValueChange:e=>el({...ei,duration:e}),description:"Time in minutes, 0 = Permanent ban"}),(0,s.jsxs)("div",{className:"flex flex-col text-xs",children:[(0,s.jsxs)("span",{children:["The ban will start again at ",(0,s.jsx)("b",{children:(0,D.Z)()})]}),(0,s.jsxs)("span",{children:["the ban will end at"," ",(0,s.jsx)("b",{children:(null==ei?void 0:ei.duration)==="0"?(0,s.jsx)("b",{className:"text-red-700",children:"Permanent"}):(0,D.Z)(new Date().getTime()+6e4*Number(null==ei?void 0:ei.duration))})]})]})]}),K&&(0,s.jsxs)(A.Z,{open:"edit"===et,handleClose:ec,action:eu,isLoading:eo,actionText:"Edit",children:[(0,s.jsx)("div",{children:"This will replace the ban duration or reason"}),(0,s.jsx)(w.Y,{label:"Ban Reason",value:(null==ei?void 0:ei.reason)||"",onValueChange:e=>el({...ei,reason:e})}),(0,s.jsx)(w.Y,{label:"Ban Time (in minutes)",type:"number",value:(null==ei?void 0:ei.duration)||"",onValueChange:e=>el({...ei,duration:e}),description:"Time in minutes, this will be added to the current duration, 0 = Permanent ban (will replace the duration)"}),(0,s.jsxs)("div",{className:"flex flex-col text-xs",children:[(0,s.jsxs)("span",{children:["The ban started at ",(0,s.jsx)("b",{children:(0,D.Z)(null==es?void 0:es.created)})]}),(0,s.jsxs)("span",{children:["After the edit, the ban will end at"," ",(0,s.jsx)("b",{children:(null==ei?void 0:ei.duration)==="0"?(0,s.jsx)("b",{className:"text-red-700",children:"Permanent"}):(0,D.Z)(new Date((null==es?void 0:es.created)||"").getTime()+6e4*Number(null==ei?void 0:ei.duration))})]})]})]}),K&&(0,s.jsx)(A.Z,{open:"delete"===et,handleClose:ec,action:eu,isLoading:eo,actionText:"Delete",children:(0,s.jsx)("div",{children:"Are you sure you want to delete the ban? this action is permanent and cannot be undone"})})]})}}}]);